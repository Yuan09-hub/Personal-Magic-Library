<!DOCTYPE html>
<html lang="zh-CN">
<head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>The Arcane Study - Atlas of Books</title>
        <link rel="stylesheet" href="style.css">
        <script src="https://d3js.org/d3.v7.min.js"></script>
        <script src="https://d3js.org/topojson.v3.min.js"></script>
        <script>
        // ç§»åŠ¨ç«¯èœå•åˆ‡æ¢
        function toggleMenu() {
            const navLinks = document.querySelector('.nav-links');
            navLinks.classList.toggle('active');
        }
        
        // å›½å®¶åˆ°åœ°ç†åæ ‡çš„æ˜ å°„ï¼ˆçœŸå®ç»çº¬åº¦ï¼‰
        const countryCoordinates = {
            // äºšæ´²
            'ä¸­å›½': { lon: 104.1954, lat: 35.8617, continent: 'asia' },
            'æ—¥æœ¬': { lon: 138.2529, lat: 36.2048, continent: 'asia' },
            'éŸ©å›½': { lon: 127.7669, lat: 35.9078, continent: 'asia' },
            'å°åº¦': { lon: 78.9629, lat: 20.5937, continent: 'asia' },
            'ä¼Šæœ—': { lon: 53.6880, lat: 32.4279, continent: 'asia' },
            'æ²™ç‰¹é˜¿æ‹‰ä¼¯': { lon: 45.0792, lat: 23.8859, continent: 'asia' },
            'ä»¥è‰²åˆ—': { lon: 34.8516, lat: 31.0461, continent: 'asia' },
            'æ–°åŠ å¡': { lon: 103.8198, lat: 1.3521, continent: 'asia' },
            'é©¬æ¥è¥¿äºš': { lon: 101.9758, lat: 4.2105, continent: 'asia' },
            'æ³°å›½': { lon: 100.9925, lat: 15.8700, continent: 'asia' },
            
            // æ¬§æ´²
            'è‹±å›½': { lon: -3.4359, lat: 55.3781, continent: 'europe' },
            'æ³•å›½': { lon: 2.2137, lat: 46.2276, continent: 'europe' },
            'å¾·å›½': { lon: 10.4515, lat: 51.1657, continent: 'europe' },
            'æ„å¤§åˆ©': { lon: 12.5674, lat: 41.8719, continent: 'europe' },
            'è¥¿ç­ç‰™': { lon: -3.7492, lat: 40.4637, continent: 'europe' },
            'è‘¡è„ç‰™': { lon: -8.2244, lat: 39.3999, continent: 'europe' },
            'ä¿„ç½—æ–¯': { lon: 37.6173, lat: 55.7558, continent: 'europe' },
            'ä¹Œå…‹å…°': { lon: 31.1656, lat: 48.3794, continent: 'europe' },
            'æ³¢å…°': { lon: 19.1451, lat: 51.9194, continent: 'europe' },
            'è·å…°': { lon: 5.2913, lat: 52.1326, continent: 'europe' },
            'æ¯”åˆ©æ—¶': { lon: 4.4699, lat: 50.5039, continent: 'europe' },
            'ç‘å£«': { lon: 8.2275, lat: 46.8182, continent: 'europe' },
            'ç‘å…¸': { lon: 18.6435, lat: 60.1282, continent: 'europe' },
            'æŒªå¨': { lon: 8.4689, lat: 60.4720, continent: 'europe' },
            'ä¸¹éº¦': { lon: 9.5018, lat: 56.2639, continent: 'europe' },
            'èŠ¬å…°': { lon: 25.7482, lat: 61.9241, continent: 'europe' },
            'çˆ±å°”å…°': { lon: -8.2439, lat: 53.4129, continent: 'europe' },
            'å†°å²›': { lon: -21.8952, lat: 64.9631, continent: 'europe' },
            'å¸Œè…Š': { lon: 23.7275, lat: 39.0742, continent: 'europe' },
            'å¥¥åœ°åˆ©': { lon: 14.5501, lat: 47.5162, continent: 'europe' },
            'æ·å…‹': { lon: 15.4730, lat: 49.8175, continent: 'europe' },
            'åŒˆç‰™åˆ©': { lon: 19.3901, lat: 47.1625, continent: 'europe' },
            'ç½—é©¬å°¼äºš': { lon: 24.9668, lat: 45.9432, continent: 'europe' },
            
            // åŒ—ç¾æ´²
            'ç¾å›½': { lon: -95.7129, lat: 37.0902, continent: 'north_america' },
            'åŠ æ‹¿å¤§': { lon: -106.3468, lat: 56.1304, continent: 'north_america' },
            'å¢¨è¥¿å“¥': { lon: -102.5528, lat: 23.6345, continent: 'north_america' },
            
            // å—ç¾æ´²
            'å·´è¥¿': { lon: -51.9253, lat: -14.2350, continent: 'south_america' },
            'é˜¿æ ¹å»·': { lon: -63.6167, lat: -38.4161, continent: 'south_america' },
            'æ™ºåˆ©': { lon: -71.5430, lat: -35.6751, continent: 'south_america' },
            'å“¥ä¼¦æ¯”äºš': { lon: -74.2973, lat: 4.5709, continent: 'south_america' },
            'ç§˜é²': { lon: -75.0152, lat: -9.1900, continent: 'south_america' },
            'å§”å†…ç‘æ‹‰': { lon: -66.5897, lat: 8.0000, continent: 'south_america' },
            
            // éæ´²
            'åŸƒåŠ': { lon: 30.8025, lat: 26.8206, continent: 'africa' },
            'å—é': { lon: 22.9375, lat: -30.5595, continent: 'africa' },
            'å°¼æ—¥åˆ©äºš': { lon: 7.9465, lat: 9.0820, continent: 'africa' },
            'è‚¯å°¼äºš': { lon: 37.9062, lat: 0.0236, continent: 'africa' },
            'æ‘©æ´›å“¥': { lon: -7.0926, lat: 31.7917, continent: 'africa' },
            'é˜¿å°”åŠåˆ©äºš': { lon: 1.6596, lat: 28.0339, continent: 'africa' },
            'åŸƒå¡ä¿„æ¯”äºš': { lon: 40.4897, lat: 9.1450, continent: 'africa' },
            
            // å¤§æ´‹æ´²
            'æ¾³å¤§åˆ©äºš': { lon: 133.7751, lat: -25.2744, continent: 'australia' },
            'æ–°è¥¿å…°': { lon: 174.8860, lat: -40.9006, continent: 'australia' },
            
            // é»˜è®¤å›½å®¶
            'å…¶ä»–': { lon: 0, lat: 0, continent: 'other' }
        };
        
        // è·å–æ‰€æœ‰ä¹¦ç±
        function getAllBooks() {
            return JSON.parse(localStorage.getItem('books')) || [];
        }
        
        // æŒ‰å›½å®¶åˆ†ç»„ä¹¦ç±
        function groupBooksByCountry() {
            const books = getAllBooks();
            const grouped = {};
            
            books.forEach(book => {
                const country = book.authorCountry || 'å…¶ä»–';
                if (!grouped[country]) {
                    grouped[country] = [];
                }
                grouped[country].push(book);
            });
            
            return grouped;
        }
        
        // å…¨å±€å˜é‡
        let projection, path, svg;
        
        // åˆå§‹åŒ–åœ°å›¾
        function initMap() {
            const mapElement = document.getElementById('worldMap');
            const width = mapElement.clientWidth;
            const height = mapElement.clientHeight;
            
            // åˆ›å»ºSVGå…ƒç´ 
            svg = d3.select(mapElement)
                .append('svg')
                .attr('width', width)
                .attr('height', height)
                .attr('class', 'continent-outline');
            
            // åˆ›å»ºåœ°å›¾æŠ•å½±ï¼ˆä½¿ç”¨Natural EarthæŠ•å½±ï¼‰
            projection = d3.geoNaturalEarth1()
                .scale(width / 6.5)
                .translate([width / 2, height / 2]);
            
            // åˆ›å»ºè·¯å¾„ç”Ÿæˆå™¨
            path = d3.geoPath().projection(projection);
            
            // åŠ è½½ä¸–ç•Œåœ°å›¾æ•°æ®
            d3.json('https://cdn.jsdelivr.net/npm/world-atlas@2/countries-110m.json')
                .then(data => {
                    // å°†TopoJSONè½¬æ¢ä¸ºGeoJSON
                    const countries = topojson.feature(data, data.objects.countries);
                    
                    // ç»˜åˆ¶å›½å®¶è¾¹ç•Œ
                    svg.selectAll('.country')
                        .data(countries.features)
                        .enter()
                        .append('path')
                        .attr('class', 'country')
                        .attr('d', path)
                        .style('fill', 'rgba(244, 228, 188, 0.3)')
                        .style('stroke', 'rgba(139, 69, 19, 0.5)')
                        .style('stroke-width', 0.5);
                    
                    // ç»˜åˆ¶å¤§æ´²è¾¹ç•Œ
                    svg.append('path')
                        .datum(topojson.mesh(data, data.objects.countries, (a, b) => a !== b))
                        .attr('class', 'continent-boundary')
                        .attr('d', path)
                        .style('fill', 'none')
                        .style('stroke', 'rgba(139, 69, 19, 0.7)')
                        .style('stroke-width', 1);
                    
                    // åˆå§‹åŒ–å®Œæˆåæ¸²æŸ“ä¹¦ç±
                    renderBookMap();
                })
                .catch(error => {
                    console.error('Error loading world map data:', error);
                    // åŠ è½½å¤±è´¥æ—¶æ˜¾ç¤ºæç¤º
                    const emptyMap = document.getElementById('emptyMap');
                    emptyMap.innerHTML = `
                        <h3>ğŸ“š åœ°å›¾åŠ è½½å¤±è´¥</h3>
                        <p>æ— æ³•åŠ è½½ä¸–ç•Œåœ°å›¾æ•°æ®ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥åé‡è¯•</p>
                    `;
                    emptyMap.style.display = 'block';
                });
        }
        
        // æ¸²æŸ“ä¹¦ç±åœ°å›¾
        function renderBookMap() {
            const groupedBooks = groupBooksByCountry();
            const mapContainer = document.getElementById('bookMap');
            
            mapContainer.innerHTML = '';
            
            // æ£€æŸ¥æ˜¯å¦æœ‰ä¹¦ç±
            const hasBooks = Object.keys(groupedBooks).some(country => groupedBooks[country].length > 0);
            if (!hasBooks) {
                const emptyMap = document.getElementById('emptyMap');
                emptyMap.style.display = 'block';
                return;
            }
            
            // éšè—ç©ºçŠ¶æ€
            const emptyMap = document.getElementById('emptyMap');
            emptyMap.style.display = 'none';
            
            // æ¸²æŸ“æ¯ä¸ªå›½å®¶çš„ä¹¦ç±
            for (const country in groupedBooks) {
                const books = groupedBooks[country];
                if (books.length === 0) continue;
                
                // è·å–å›½å®¶ç»çº¬åº¦
                const coords = countryCoordinates[country] || countryCoordinates['å…¶ä»–'];
                
                // ä½¿ç”¨D3æŠ•å½±è½¬æ¢ä¸ºå±å¹•åæ ‡
                const [x, y] = projection([coords.lon, coords.lat]);
                
                // åˆ›å»ºå›½å®¶ä¹¦ç±å®¹å™¨
                const countryContainer = document.createElement('div');
                countryContainer.className = 'country-books';
                countryContainer.style.left = `${x}px`;
                countryContainer.style.top = `${y}px`;
                countryContainer.dataset.country = country;
                countryContainer.dataset.continent = coords.continent;
                
                // æ·»åŠ å›½å®¶æ ‡ç­¾
                const countryLabel = document.createElement('div');
                countryLabel.className = 'country-label';
                countryLabel.textContent = country;
                countryContainer.appendChild(countryLabel);
                
                // åˆ›å»ºä¹¦ç±ç½‘æ ¼
                const booksGrid = document.createElement('div');
                booksGrid.className = 'books-grid';
                
                // æ¸²æŸ“ä¹¦ç±
                books.forEach((book, index) => {
                    const bookElement = document.createElement('div');
                    bookElement.className = 'book-card';
                    bookElement.style.animationDelay = `${index * 0.1}s`;
                    
                    // è®¡ç®—åç§»é‡ï¼ˆè½»å¾®é”™å¼€æ•ˆæœï¼‰
                    const offsetX = (index % 3) * 2;
                    const offsetY = Math.floor(index / 3) * 2;
                    bookElement.style.transform = `translate(${offsetX}px, ${offsetY}px)`;
                    
                    // ä¹¦ç±å°é¢
                    bookElement.innerHTML = `
                        <div class="book-cover" style="${book.coverUrl ? `background-image: url('${book.coverUrl}')` : 'background: linear-gradient(135deg, #8b4513 0%, #d4a76a 100%);'}">
                            ${!book.coverUrl ? `<div class="book-title-placeholder">${book.title.charAt(0)}</div>` : ''}
                        </div>
                        <div class="book-tooltip">
                            <h4>${book.title}</h4>
                            <p>${book.author}</p>
                            <p>${book.authorCountry}</p>
                        </div>
                    `;
                    
                    // æ·»åŠ ç‚¹å‡»äº‹ä»¶ï¼Œæ˜¾ç¤ºä¹¦ç±è¯¦ç»†ä¿¡æ¯
                    bookElement.addEventListener('click', function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        showBookDetails(book.id);
                    });
                    
                    booksGrid.appendChild(bookElement);
                });
                
                countryContainer.appendChild(booksGrid);
                mapContainer.appendChild(countryContainer);
            }
        }
        
        // å®ç°ç¼©æ”¾åŠŸèƒ½
        function setupZoom() {
            const map = document.getElementById('worldMap');
            let scale = 1;
            const zoomSpeed = 0.1;
            
            // é¼ æ ‡æ»šè½®ç¼©æ”¾
            map.addEventListener('wheel', (e) => {
                e.preventDefault();
                
                const delta = e.deltaY > 0 ? -zoomSpeed : zoomSpeed;
                scale = Math.max(0.5, Math.min(3, scale + delta));
                
                map.style.transform = `scale(${scale})`;
            });
            
            // é‡ç½®ç¼©æ”¾
            const resetBtn = document.getElementById('resetZoom');
            resetBtn.addEventListener('click', () => {
                scale = 1;
                map.style.transform = `scale(1)`;
            });
        }
        
        // æ˜¾ç¤ºä¹¦ç±è¯¦ç»†ä¿¡æ¯
        function showBookDetails(bookId) {
            const books = getAllBooks();
            const book = books.find(b => b.id === bookId);
            if (!book) return;
            
            // åˆ›å»ºä¹¦ç±è¯¦æƒ…å¼¹çª—
            let popup = document.getElementById('bookDetailsPopup');
            if (!popup) {
                popup = document.createElement('div');
                popup.id = 'bookDetailsPopup';
                popup.className = 'book-details-popup';
                document.body.appendChild(popup);
            }
            
            // æ„å»ºä¹¦ç±è¯¦æƒ…HTMLï¼Œå±•ç¤ºæ‰€æœ‰ä¿¡æ¯
            popup.innerHTML = `
                <div class="book-details-content">
                    <div class="popup-header">
                        <h3>${book.title}</h3>
                        <button class="close-btn" id="closePopupBtn">&times;</button>
                    </div>
                    <div class="book-details-body">
                        ${book.coverUrl ? `<div class="book-cover-large" style="background-image: url('${book.coverUrl}'); background-size: cover; background-position: center;"></div>` : ''}
                        <div class="book-info">
                            <p><strong>ä¹¦åï¼š</strong>${book.title}</p>
                            <p><strong>ä½œè€…ï¼š</strong>${book.author}</p>
                            <p><strong>ä½œè€…å›½ç±ï¼š</strong>${book.authorCountry}</p>
                            ${book.originalTitle ? `<p><strong>åŸä¹¦åï¼š</strong>${book.originalTitle}</p>` : '<p><strong>åŸä¹¦åï¼š</strong>æ— </p>'}
                            ${book.translator ? `<p><strong>è¯‘è€…ï¼š</strong>${book.translator}</p>` : '<p><strong>è¯‘è€…ï¼š</strong>æ— </p>'}
                            <p><strong>åˆ†ç±»ï¼š</strong>${getCategoryName(book.category)}</p>
                            <p><strong>æ·»åŠ æ—¶é—´ï¼š</strong>${new Date(book.addedAt).toLocaleString('zh-CN')}</p>
                        </div>
                    </div>
                </div>
            `;
            
            // æ˜¾ç¤ºå¼¹çª—
            popup.classList.add('active');
            
            // é˜²æ­¢èƒŒæ™¯æ»šåŠ¨
            document.body.classList.add('popup-open');
            
            // æ·»åŠ å…³é—­æŒ‰é’®äº‹ä»¶ç›‘å¬å™¨
            const closeBtn = document.getElementById('closePopupBtn');
            if (closeBtn) {
                closeBtn.addEventListener('click', closeBookDetails);
            }
            
            // æ·»åŠ ç‚¹å‡»å¤–éƒ¨å…³é—­åŠŸèƒ½
            popup.onclick = function(e) {
                if (e.target === popup) {
                    closeBookDetails();
                }
            };
        }
        
        // å…³é—­ä¹¦ç±è¯¦æƒ…å¼¹çª—
        function closeBookDetails() {
            const popup = document.getElementById('bookDetailsPopup');
            if (popup) {
                popup.classList.remove('active');
            }
            
            // å…è®¸èƒŒæ™¯æ»šåŠ¨
            document.body.classList.remove('popup-open');
        }
        
        // è·å–åˆ†ç±»åç§°
        function getCategoryName(categoryValue) {
            const categoryNames = {
                'literature': 'æ–‡å­¦',
                'history': 'å†å²',
                'philosophy': 'å“²å­¦',
                'science': 'ç§‘å­¦',
                'art': 'è‰ºæœ¯',
                'other': 'å…¶ä»–'
            };
            return categoryNames[categoryValue] || categoryValue;
        }
        
        // å®ç°æ‹–æ‹½åŠŸèƒ½
        function setupDrag() {
            const map = document.getElementById('worldMap');
            let isDragging = false;
            let startX, startY;
            let translateX = 0, translateY = 0;
            
            map.addEventListener('mousedown', (e) => {
                // åªæœ‰ç‚¹å‡»åœ°å›¾èƒŒæ™¯æˆ–å¤§æ´²è½®å»“æ—¶æ‰å…è®¸æ‹–æ‹½
                if (e.target === map || e.target.tagName === 'path' || e.target.classList.contains('continent-outline')) {
                    isDragging = true;
                    startX = e.clientX - translateX;
                    startY = e.clientY - translateY;
                    map.style.cursor = 'grabbing';
                }
            });
            
            document.addEventListener('mousemove', (e) => {
                if (!isDragging) return;
                
                translateX = e.clientX - startX;
                translateY = e.clientY - startY;
                
                map.style.transform = `translate(${translateX}px, ${translateY}px) scale(${map.style.transform.match(/scale\(([0-9.]+)\)/)?.[1] || 1})`;
            });
            
            document.addEventListener('mouseup', () => {
                isDragging = false;
                map.style.cursor = 'grab';
            });
        }
        
        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        window.onload = function() {
            initMap();
            setupZoom();
            setupDrag();
            
            // ç›‘å¬çª—å£å¤§å°å˜åŒ–ï¼Œé‡æ–°è°ƒæ•´åœ°å›¾
            window.addEventListener('resize', () => {
                // æ¸…é™¤ç°æœ‰SVG
                d3.select('.continent-outline').remove();
                // é‡æ–°åˆå§‹åŒ–åœ°å›¾
                initMap();
            });
        };
    </script>
    <style>
        /* ä¹¦ç±åœ°å›¾ä¸“ç”¨æ ·å¼ */
        .atlas-container {
            margin: 2rem 0;
            position: relative;
        }
        
        /* ä¸–ç•Œåœ°å›¾å®¹å™¨ */
        .world-map {
            width: 100%;
            height: 90vh;
            background: #ffffff;
            border-radius: 15px;
            box-shadow: 0 15px 50px rgba(0, 0, 0, 0.9);
            margin: 2rem 0;
            position: relative;
            overflow: hidden;
            border: 5px solid #8b4513;
            cursor: grab;
            transition: transform 0.2s ease;
            transform-origin: center;
        }
        
        .world-map:active {
            cursor: grabbing;
        }
        
        /* å¤§æ´²è½®å»“ */
        .continent-outline {
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
            pointer-events: none;
            z-index: 1;
        }
        
        .continent-outline path {
            fill: rgba(244, 228, 188, 0.3);
            stroke: rgba(139, 69, 19, 0.5);
            stroke-width: 2;
            transition: fill 0.3s ease;
        }
        
        /* ä¹¦ç±åœ°å›¾å®¹å™¨ */
        #bookMap {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 2;
            pointer-events: none;
        }
        
        /* å›½å®¶ä¹¦ç±å®¹å™¨ */
        .country-books {
            position: absolute;
            transform: translate(-50%, -50%);
            pointer-events: auto;
            z-index: 3;
        }
        
        /* å›½å®¶æ ‡ç­¾ */
        .country-label {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(26, 18, 10, 0.7);
            color: #f4e4bc;
            padding: 0.2rem 0.6rem;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: bold;
            white-space: nowrap;
            margin-bottom: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
            z-index: 4;
        }
        
        /* ä¹¦ç±ç½‘æ ¼ */
        .books-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(20px, 1fr));
            gap: 4px;
            max-width: 100px;
            background: rgba(244, 228, 188, 0.5);
            padding: 6px;
            border-radius: 8px;
            box-shadow: 0 3px 15px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(139, 69, 19, 0.3);
            transition: all 0.3s ease;
        }
        
        .country-books:hover .books-grid {
            transform: scale(1.05);
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
        }
        
        /* ä¹¦ç±å¡ç‰‡ */
        .book-card {
            position: relative;
            width: 20px;
            height: 28px;
            border-radius: 2px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
            animation: fadeInUp 0.5s ease forwards;
            opacity: 0;
            transform: translateY(15px);
            cursor: pointer;
        }
        
        .book-card:hover {
            transform: translate(0, 0) scale(1.3) !important;
            z-index: 100 !important;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.8) !important;
        }
        
        @keyframes fadeInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* ä¹¦ç±å°é¢ */
        .book-cover {
            width: 100%;
            height: 100%;
            background-size: cover;
            background-position: center;
            border: 2px solid #d4a76a;
            border-radius: 5px;
            transition: all 0.3s ease;
        }
        
        /* ä¹¦ç±æ ‡é¢˜å ä½ç¬¦ */
        .book-title-placeholder {
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.5rem;
            font-weight: bold;
            color: #f4e4bc;
            text-shadow: 0 0 5px rgba(0, 0, 0, 0.8);
            background: rgba(139, 69, 19, 0.8);
        }
        
        /* ä¹¦ç±è¯¦æƒ…å¼¹çª—æ ·å¼ - ä½¿ç”¨ä¸style.cssä¸€è‡´çš„æ ·å¼ */
        .book-details-popup {
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
            display: none;
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.3s ease;
        }
        
        .book-details-popup.active {
            display: flex;
        }
        
        /* é˜²æ­¢èƒŒæ™¯æ»šåŠ¨ */
        body.popup-open {
            overflow: hidden;
        }
        
        /* ç§»é™¤é»˜è®¤æ»šåŠ¨æ¡æ ·å¼ */
        .book-details-content::-webkit-scrollbar {
            width: 8px;
        }
        
        .book-details-content::-webkit-scrollbar-track {
            background: rgba(139, 69, 19, 0.1);
        }
        
        .book-details-content::-webkit-scrollbar-thumb {
            background: rgba(139, 69, 19, 0.4);
            border-radius: 4px;
        }
        
        .book-details-content::-webkit-scrollbar-thumb:hover {
            background: rgba(139, 69, 19, 0.6);
        }
        
        /* ä¹¦ç±è¯¦æƒ…å†…å®¹æ ·å¼ - ä½¿ç”¨ä¸style.cssä¸€è‡´çš„æ ·å¼ */
        .book-details-content {
            background: #f4e4bc;
            border-radius: 12px;
            box-shadow: 0 15px 40px rgba(139, 69, 19, 0.3);
            max-width: 600px;
            width: fit-content;
            min-width: 500px;
            max-height: 85vh;
            overflow-y: auto;
            animation: fadeIn 0.4s ease;
            border: 1px solid rgba(139, 69, 19, 0.2);
        }
        
        /* ä¹¦ç±è¯¦æƒ…å†…å®¹æ ·å¼ */
        .book-details-body {
            display: flex;
            flex-direction: column;
            gap: 2rem;
            align-items: center;
            justify-content: center;
            padding: 1.5rem;
            text-align: center;
        }
        
        .book-cover-large {
            width: 220px;
            height: auto;
            aspect-ratio: 2/3;
            background-size: cover;
            background-position: center;
            border-radius: 10px;
            margin: 0 auto;
            box-shadow: 
                0 8px 25px rgba(0, 0, 0, 0.3),
                inset 0 0 0 1px rgba(255, 255, 255, 0.5),
                0 0 30px rgba(212, 167, 106, 0.2);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            flex-shrink: 0;
        }
        
        .book-cover-large::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, transparent 50%);
            pointer-events: none;
        }
        
        .book-cover-large:hover {
            transform: translateY(-5px);
            box-shadow: 
                0 12px 35px rgba(0, 0, 0, 0.4),
                inset 0 0 0 1px rgba(255, 255, 255, 0.7),
                0 0 40px rgba(212, 167, 106, 0.3);
        }
        
        .book-info {
            width: 100%;
            max-width: 450px;
            color: #3a2f1e;
            background: rgba(255, 255, 255, 0.6);
            padding: 1.5rem;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(139, 69, 19, 0.1);
            font-size: 1rem;
            line-height: 1.7;
            text-align: left;
        }
        
        .book-info p {
            margin: 1rem 0;
            display: flex;
            align-items: center;
        }
        
        .book-info strong {
            color: #8b4513;
            font-weight: bold;
            min-width: 80px;
            display: inline-block;
            margin-right: 0.5rem;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: scale(0.95);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }
        
        /* ä¹¦ç±æç¤ºæ¡† */
        .book-tooltip {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(26, 18, 10, 0.95);
            color: #f4e4bc;
            padding: 0.8rem;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.8);
            border: 2px solid #d4a76a;
            min-width: 200px;
            z-index: 200;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            margin-bottom: 10px;
            pointer-events: none;
        }
        
        .book-card:hover .book-tooltip {
            opacity: 1;
            visibility: visible;
            transform: translateX(-50%) translateY(-10px);
        }
        
        .book-tooltip h4 {
            color: #d4a76a;
            margin: 0 0 0.3rem 0;
            font-size: 1rem;
        }
        
        .book-tooltip p {
            margin: 0.2rem 0;
            font-size: 0.8rem;
        }
        
        /* æ“ä½œæŒ‰é’® */
        .map-controls {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 1000;
            display: flex;
            gap: 10px;
        }
        
        .map-control-btn {
            background: rgba(26, 18, 10, 0.9);
            color: #d4a76a;
            border: 2px solid #d4a76a;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.2rem;
            transition: all 0.3s ease;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.6);
        }
        
        .map-control-btn:hover {
            background: rgba(212, 167, 106, 0.9);
            color: #3a2f1e;
            transform: scale(1.1);
            box-shadow: 0 5px 15px rgba(212, 167, 106, 0.8);
        }
        
        /* ç©ºçŠ¶æ€ */
        .empty-map {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            color: #8b4513;
            z-index: 10;
            background: rgba(244, 228, 188, 0.95);
            padding: 2rem;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.6);
            border: 3px solid #d4a76a;
        }
        
        .empty-map h3 {
            color: #d4a76a;
            font-size: 1.5rem;
            margin-bottom: 1rem;
        }
        
        .empty-map p {
            margin: 0.5rem 0;
        }
        
        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .world-map {
                height: 70vh;
            }
            
            .book-card {
                width: 18px;
                height: 25px;
            }
            
            .books-grid {
                grid-template-columns: repeat(auto-fit, minmax(18px, 1fr));
                gap: 4px;
                padding: 5px;
                max-width: 100px;
            }
            
            .country-label {
                font-size: 0.7rem;
                padding: 0.15rem 0.5rem;
            }
        }
        
        /* ç¡®ä¿ä¹¦ç±å¡ç‰‡ç¼©æ”¾ä¸ä¼šè¶…è¿‡å¤§æ´²å®½åº¦çš„15% */
        .book-card:hover {
            transform: translate(0, 0) scale(1.2) !important;
            z-index: 100 !important;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5) !important;
        }
    </style>
</head>
<body>
    <!-- å¯¼èˆªæ  -->
    <nav class="navbar">
        <div class="navbar-container">
            <a href="index.html" class="logo">ä¸ªäººé­”æ³•ä¹¦æˆ¿</a>
            <div class="menu-toggle" onclick="toggleMenu()">
                <div class="bar"></div>
                <div class="bar"></div>
                <div class="bar"></div>
            </div>
            <ul class="nav-links">
                <li><a href="index.html">æˆ‘çš„è—ä¹¦</a></li>
                <li><a href="atlas.html">ä¹¦ç±åœ°å›¾</a></li>
                <li><a href="notes.html">ä¸»é¢˜æœ­è®°</a></li>
                <li><a href="reading_challenge.html">é˜…è¯»æŒ‘æˆ˜</a></li>
                <li><a href="moments.html">ç¬é—´è®°å½•</a></li>
            </ul>
        </div>
    </nav>

    <!-- ä¸»å†…å®¹åŒº -->
    <div class="container">
        <h1>Atlas of Books</h1>
        <p>æ¢ç´¢ä½ çš„é˜…è¯»è¶³è¿¹ï¼Œå‘ç°å…¨çƒä½œè€…çš„ä¹¦ç±åˆ†å¸ƒ</p>

        <!-- åœ°å›¾å®¹å™¨ -->
        <div class="atlas-container">
            <!-- åœ°å›¾æ“ä½œæŒ‰é’® -->
            <div class="map-controls">
                <button id="resetZoom" class="map-control-btn" title="é‡ç½®ç¼©æ”¾">ğŸ”„</button>
            </div>
            
            <div id="worldMap" class="world-map">
                <!-- ä¹¦ç±åœ°å›¾å®¹å™¨ -->
                <div id="bookMap"></div>
                
                <!-- ç©ºçŠ¶æ€æç¤º -->
                <div id="emptyMap" class="empty-map">
                    <h3>ğŸ“š ä½ çš„ä¹¦æ¶è¿˜æ²¡æœ‰ä¹¦ç±</h3>
                    <p>å»é¦–é¡µæ·»åŠ ä¹¦ç±ï¼Œå®ƒä»¬ä¼šè‡ªåŠ¨å‡ºç°åœ¨ä¸–ç•Œåœ°å›¾ä¸Š</p>
                    <a href="index.html" class="btn" style="margin-top: 1rem; display: inline-block;">æ·»åŠ ä¹¦ç±</a>
                </div>
            </div>
        </div>
        
        <!-- åœ°å›¾è¯´æ˜ -->
        <div class="card" style="margin-top: 2rem;">
            <h3>å¦‚ä½•ä½¿ç”¨</h3>
            <ul style="list-style-type: disc; margin-left: 2rem; line-height: 1.8;">
                <li><strong>æŸ¥çœ‹ä¹¦ç±ï¼š</strong>å°†é¼ æ ‡æ‚¬åœåœ¨ä¹¦ç±å°é¢ä¸ŠæŸ¥çœ‹è¯¦ç»†ä¿¡æ¯</li>
                <li><strong>ç¼©æ”¾åœ°å›¾ï¼š</strong>ä½¿ç”¨é¼ æ ‡æ»šè½®æ”¾å¤§æˆ–ç¼©å°åœ°å›¾</li>
                <li><strong>æ‹–åŠ¨åœ°å›¾ï¼š</strong>æŒ‰ä½é¼ æ ‡å·¦é”®æ‹–åŠ¨åœ°å›¾</li>
                <li><strong>é‡ç½®è§†å›¾ï¼š</strong>ç‚¹å‡»å³ä¸Šè§’çš„ğŸ”„æŒ‰é’®é‡ç½®åœ°å›¾</li>
                <li><strong>æ·»åŠ ä¹¦ç±ï¼š</strong>å»é¦–é¡µæ·»åŠ ä¹¦ç±ï¼Œå®ƒä»¬ä¼šè‡ªåŠ¨æŒ‰ä½œè€…å›½ç±åˆ†ç±»æ˜¾ç¤ºåœ¨åœ°å›¾ä¸Š</li>
            </ul>
        </div>
    </div>

    <!-- é¡µè„š -->
    <footer>
        <p>&copy; 2025 The Arcane Study. ä¿ç•™æ‰€æœ‰æƒåˆ©.</p>
    </footer>

    <!-- æ»šåŠ¨åˆ°é¡¶éƒ¨æŒ‰é’® -->
    <button class="scroll-top-btn" onclick="window.scrollTo({top: 0, behavior: 'smooth'})