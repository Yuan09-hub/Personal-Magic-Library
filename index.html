<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸ªäººä¹¦æˆ¿ - ä¸»é¡µ</title>
    <link rel="stylesheet" href="style.css">
    <style>
        /* æˆ‘çš„é­”æ³•è—ä¹¦åŒºåŸŸèƒŒæ™¯å›¾æ ·å¼ - è¦†ç›–é»˜è®¤æ ·å¼ */
        .virtual-study {
            background-image: url('images/library-hero.png') !important;
            background-size: cover !important;
            background-position: center !important;
            background-blend-mode: normal !important;
            position: relative;
            overflow: hidden;
        }
        
        /* æ·»åŠ æ·±è‰²åŠé€æ˜é®ç½© */
        .virtual-study::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6); /* æ·±è‰²åŠé€æ˜é®ç½© */
            z-index: 1;
        }
        
        /* ç¡®ä¿å†…å®¹åœ¨é®ç½©ä¹‹ä¸Š */
        .virtual-study > * {
            position: relative;
            z-index: 2;
        }
        
        /* ç¡®ä¿é®ç½©ä¸å½±å“å†…å®¹åŒºåŸŸ */
        .add-book-section {
            position: relative;
            z-index: 10 !important;
        }
    </style>
    <script>
        // ç§»åŠ¨ç«¯èœå•åˆ‡æ¢
        function toggleMenu() {
            const navLinks = document.querySelector('.nav-links');
            navLinks.classList.toggle('active');
        }
        
        // ä¹¦ç±åˆ†ç±»æ•°æ®åº“
        const bookCategories = {
            // æ–‡å­¦ç±»
            'çº¢æ¥¼æ¢¦': 'literature', 'ç™¾å¹´å­¤ç‹¬': 'literature', 'æ´»ç€': 'literature', '1984': 'literature',
            'è¿½é£ç­çš„äºº': 'literature', 'è§£å¿§æ‚è´§åº—': 'literature', 'å°ç‹å­': 'literature', 'å›´åŸ': 'literature',
            'æŒªå¨çš„æ£®æ—': 'literature', 'éº¦ç”°é‡Œçš„å®ˆæœ›è€…': 'literature', 'æ€æ­»ä¸€åªçŸ¥æ›´é¸Ÿ': 'literature',
            'å‚²æ…¢ä¸åè§': 'literature', 'ç®€çˆ±': 'literature', 'å‘¼å•¸å±±åº„': 'literature', 'æˆ˜äº‰ä¸å’Œå¹³': 'literature',
            'è€äººä¸æµ·': 'literature', 'é£˜': 'literature', 'äº†ä¸èµ·çš„ç›–èŒ¨æ¯”': 'literature', 'å¹³å‡¡çš„ä¸–ç•Œ': 'literature',
            'çº¢ä¸é»‘': 'literature', 'æ‚²æƒ¨ä¸–ç•Œ': 'literature', 'å®‰å¨œÂ·å¡åˆ—å°¼å¨œ': 'literature', 'ç½ªä¸ç½š': 'literature',
            'åŸºç£å±±ä¼¯çˆµ': 'literature', 'å·´é»åœ£æ¯é™¢': 'literature', 'å ‚å‰è¯ƒå¾·': 'literature', 'ä¸‰ä½“': 'literature',
            
            // å†å²ç±»
            'äººç±»ç®€å²': 'history', 'å…¨çƒé€šå²': 'history', 'å²è®°': 'history', 'èµ„æ²»é€šé‰´': 'history',
            'ç½—é©¬å¸å›½è¡°äº¡å²': 'history', 'ä¸­å›½é€šå²': 'history', 'ä¸Šä¸‹äº”åƒå¹´': 'history', 'ä¸–ç•Œå²çº²': 'history',
            'è¿‘ä»£ä¸­å›½ç¤¾ä¼šçš„æ–°é™ˆä»£è°¢': 'history', 'ä¸‡å†åäº”å¹´': 'history',
            
            // å“²å­¦ç±»
            'ç†æƒ³å›½': 'philosophy', 'å°¼å„é©¬å¯ä¼¦ç†å­¦': 'philosophy', 'å­˜åœ¨ä¸æ—¶é—´': 'philosophy',
            'æŸ¥æ‹‰å›¾æ–¯ç‰¹æ‹‰å¦‚æ˜¯è¯´': 'philosophy', 'å±€å¤–äºº': 'philosophy', 'è¥¿è¥¿å¼—ç¥è¯': 'philosophy',
            'è®ºè‡ªç”±': 'philosophy', 'åŠŸåˆ©ä¸»ä¹‰': 'philosophy', 'ç¤¾ä¼šå¥‘çº¦è®º': 'philosophy',
            'åˆ©ç»´å¦': 'philosophy', 'å›ä¸»è®º': 'philosophy', 'æ”¿æ²»å­¦': 'philosophy',
            'çº¯ç²¹ç†æ€§æ‰¹åˆ¤': 'philosophy', 'èµ„æœ¬è®º': 'philosophy', 'å…±äº§å…šå®£è¨€': 'philosophy',
            'é“å¾·ç»': 'philosophy', 'è®ºè¯­': 'philosophy', 'å­Ÿå­': 'philosophy', 'åº„å­': 'philosophy',
            'å›ç»': 'philosophy',
            
            // ç§‘å­¦ç±»
            'æ—¶é—´ç®€å²': 'science', 'æœå£³ä¸­çš„å®‡å®™': 'science', 'é»‘æ´ä¸æ—¶é—´å¼¯æ›²': 'science',
            'å®‡å®™çš„ç´å¼¦': 'science', 'é‡å­åŠ›å­¦å²è¯': 'science', 'ä¸Šå¸æ·éª°å­å—': 'science',
            'è‡ªç§çš„åŸºå› ': 'science', 'ç‰©ç§èµ·æº': 'science', 'ä¸‡ç‰©ç®€å²': 'science', 'ä»ä¸€åˆ°æ— ç©·å¤§': 'science',
            'ç‰©ç†å­¦çš„è¿›åŒ–': 'science', 'å‡ ä½•åŸæœ¬': 'science', 'è‡ªç„¶å“²å­¦çš„æ•°å­¦åŸç†': 'science',
            'åŒ–å­¦ç®€å²': 'science', 'ç”Ÿç‰©å­¦æ€æƒ³å‘å±•çš„å†å²': 'science',
            
            // è‰ºæœ¯ç±»
            'è‰ºæœ¯çš„æ•…äº‹': 'art', 'ç¾å­¦åŸç†': 'art', 'è¥¿æ–¹ç¾æœ¯å²': 'art', 'ä¸­å›½ç¾æœ¯å²': 'art',
            'è®¾è®¡ä¸­çš„è®¾è®¡': 'art', 'ç¾çš„å†ç¨‹': 'art', 'è‰ºæœ¯å“²å­¦': 'art', 'ä¸–ç•Œç¾æœ¯åä½œäºŒåè®²': 'art',
            'ä¸­å›½ä¹¦æ³•å²': 'art', 'æ‘„å½±æ„å›¾å­¦': 'art', 'è‰²å½©ç†è®º': 'art'
        };
        
        // æ·»åŠ ä¹¦ç±åŠŸèƒ½
        function addBook() {
            try {
                console.log('å¼€å§‹æ·»åŠ ä¹¦ç±...');
                const title = document.getElementById('book-title').value.trim();
                const author = document.getElementById('book-author').value.trim();
                const authorCountry = document.getElementById('book-author-country').value.trim();
                const coverFile = document.getElementById('book-cover').files[0];
                const originalTitle = document.getElementById('book-original-title').value.trim();
                const translator = document.getElementById('book-translator').value.trim();
                const category = document.getElementById('book-category').value;
                
                console.log('è¡¨å•æ•°æ®:', {
                    title, author, authorCountry, hasCover: !!coverFile, category
                });
                
                if (!title) {
                    alert('è¯·å¡«å†™ä¹¦åï¼');
                    return;
                }
                if (!author) {
                    alert('è¯·å¡«å†™ä½œè€…ï¼');
                    return;
                }
                if (!authorCountry) {
                    alert('è¯·å¡«å†™ä½œè€…å›½ç±ï¼');
                    return;
                }
                if (!coverFile) {
                    alert('è¯·ä¸Šä¼ ä¹¦ç±å°é¢å›¾ï¼');
                    return;
                }
                if (!category) {
                    alert('è¯·é€‰æ‹©åˆ†ç±»ï¼');
                    return;
                }
                
                console.log('å‡†å¤‡å¤„ç†å°é¢å›¾...');
                // å¤„ç†å°é¢å›¾ï¼ˆè¿™é‡Œç®€åŒ–å¤„ç†ï¼Œå®é™…é¡¹ç›®ä¸­å¯èƒ½éœ€è¦ä¸Šä¼ åˆ°æœåŠ¡å™¨ï¼‰
                if (coverFile) {
                    // ä½¿ç”¨FileReaderå°†å›¾ç‰‡è½¬æ¢ä¸ºDataURL
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        try {
                            console.log('å°é¢å›¾è¯»å–æˆåŠŸï¼');
                            const coverUrl = e.target.result;
                            
                            // åˆ›å»ºä¹¦ç±å¯¹è±¡
                            const book = {
                                id: Date.now(),
                                title: title,
                                author: author,
                                authorCountry: authorCountry,
                                coverUrl: coverUrl,
                                originalTitle: originalTitle,
                                translator: translator,
                                category: category,
                                addedAt: new Date().toISOString()
                            };
                            
                            console.log('åˆ›å»ºä¹¦ç±å¯¹è±¡æˆåŠŸ:', book);
                            // åç»­å¤„ç†...
                            processBook(book);
                        } catch (error) {
                            console.error('å°é¢å›¾å¤„ç†æˆåŠŸåå‘ç”Ÿé”™è¯¯:', error);
                            alert('æ·»åŠ ä¹¦ç±å¤±è´¥ï¼Œè¯·é‡è¯•ï¼');
                        }
                    };
                    
                    // æ·»åŠ é”™è¯¯å¤„ç†
                    reader.onerror = function(e) {
                        console.error('å°é¢å›¾ç‰‡è¯»å–å¤±è´¥ï¼', e);
                        alert('å°é¢å›¾ç‰‡è¯»å–å¤±è´¥ï¼Œè¯·é‡è¯•ï¼');
                    };
                    
                    reader.onabort = function() {
                        console.error('å°é¢å›¾ç‰‡è¯»å–è¢«ä¸­æ­¢ï¼');
                        alert('å°é¢å›¾ç‰‡è¯»å–è¢«ä¸­æ­¢ï¼Œè¯·é‡è¯•ï¼');
                    };
                    
                    reader.readAsDataURL(coverFile);
                } else {
                    // æ²¡æœ‰å°é¢å›¾æ—¶çš„å¤„ç†
                    const book = {
                        id: Date.now(),
                        title: title,
                        author: author,
                        authorCountry: authorCountry,
                        coverUrl: '',
                        originalTitle: originalTitle,
                        translator: translator,
                        category: category,
                        addedAt: new Date().toISOString()
                    };
                    
                    console.log('åˆ›å»ºä¹¦ç±å¯¹è±¡æˆåŠŸï¼ˆæ— å°é¢ï¼‰:', book);
                    // åç»­å¤„ç†...
                    processBook(book);
                }
                
                return; // ç»ˆæ­¢å‡½æ•°æ‰§è¡Œï¼Œç­‰å¾…FileReaderå®Œæˆ
            } catch (error) {
                console.error('addBook å‡½æ•°å‘ç”Ÿé”™è¯¯:', error);
                alert('æ·»åŠ ä¹¦ç±å¤±è´¥ï¼Œè¯·é‡è¯•ï¼');
            }
        }
        
        // å¤„ç†ä¹¦ç±æ·»åŠ çš„åç»­é€»è¾‘
        function processBook(book) {
            console.log('å¼€å§‹å¤„ç†ä¹¦ç±...', book);
            
            try {
                // 1. é¦–å…ˆä¿å­˜ä¹¦ç±åˆ°æœ¬åœ°å­˜å‚¨
                const saveSuccess = saveBookToStorage(book);
                if (!saveSuccess) {
                    console.error('ä¹¦ç±ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨å¤±è´¥ï¼');
                    // æä¾›æ›´è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯
                    alert('æ·»åŠ ä¹¦ç±å¤±è´¥ï¼Œè¯·é‡è¯•ï¼\nå¯èƒ½åŸå› ï¼š\n1. æµè§ˆå™¨å­˜å‚¨ç©ºé—´ä¸è¶³\n2. å­˜å‚¨æ•°æ®æ ¼å¼å¼‚å¸¸');
                    return;
                }
                console.log('ä¹¦ç±ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨æˆåŠŸï¼');
                
                // 2. æ›´æ–°æœ€è¿‘é˜…è¯»
                updateRecentReading(book);
                console.log('æ›´æ–°æœ€è¿‘é˜…è¯»æˆåŠŸï¼');
                
                // 3. é‡æ–°åŠ è½½ä¹¦æ¶ï¼Œç¡®ä¿æ‰€æœ‰ä¹¦ç±ï¼ˆåŒ…æ‹¬æ–°å¢çš„ï¼‰éƒ½èƒ½æ­£ç¡®æ˜¾ç¤º
                loadBooksFromStorage();
                console.log('é‡æ–°åŠ è½½ä¹¦æ¶æˆåŠŸï¼');
                
                // 4. æ›´æ–°é˜…è¯»ç»Ÿè®¡
                updateReadingStats();
                console.log('æ›´æ–°é˜…è¯»ç»Ÿè®¡æˆåŠŸï¼');
                
                // 5. æ›´æ–°æ·»åŠ ä¹¦ç±åŒºåŸŸçš„æ ‡é¢˜
                const sectionTitle = document.querySelector('.add-book-section h3');
                if (sectionTitle) {
                    sectionTitle.textContent = 'ç»§ç»­æ·»åŠ ä¹¦ç±';
                }
                console.log('æ›´æ–°æ·»åŠ ä¹¦ç±åŒºåŸŸæ ‡é¢˜æˆåŠŸï¼');
                
                // 6. æ¸…ç©ºè¡¨å• - åœ¨ä¹¦ç±æˆåŠŸä¿å­˜åæ‰§è¡Œ
                clearBookForm();
                console.log('æ¸…ç©ºè¡¨å•æˆåŠŸï¼');
                
                // 7. æ·»åŠ æˆåŠŸæç¤º - ä½¿ç”¨æ›´å‹å¥½çš„æç¤ºæ–¹å¼
                showSuccessMessage(`ğŸ“˜ã€Š${book.title}ã€‹å·²æˆåŠŸåŠ å…¥ä¹¦æ¶`);
                console.log('æ˜¾ç¤ºæˆåŠŸæç¤ºæˆåŠŸï¼');
                
                // ç¡®ä¿æ‰€æœ‰ç›¸å…³ç»„ä»¶éƒ½å·²æ›´æ–°
                console.log('æ·»åŠ ä¹¦ç±æµç¨‹å®Œæˆï¼Œæ‰€æœ‰ç›¸å…³ç»„ä»¶å·²æ›´æ–°ï¼');
            } catch (error) {
                console.error('processBook é”™è¯¯:', error);
                alert('æ·»åŠ ä¹¦ç±è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯ï¼Œè¯·é‡è¯•ï¼');
            }
        }
        
        // æ¸…ç©ºè¡¨å•å‡½æ•°
        function clearBookForm() {
            // æ¸…ç©ºæ–‡æœ¬è¾“å…¥
            document.getElementById('book-title').value = '';
            document.getElementById('book-author').value = '';
            document.getElementById('book-author-country').value = '';
            document.getElementById('book-original-title').value = '';
            document.getElementById('book-translator').value = '';
            document.getElementById('book-category').value = '';
            
            // æ¸…ç©ºæ–‡ä»¶è¾“å…¥
            const coverInput = document.getElementById('book-cover');
            if (coverInput) {
                coverInput.value = '';
            }
        }
        
        // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯ - ä½¿ç”¨toastæç¤º
        function showSuccessMessage(message) {
            console.log('æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯:', message);
            
            // åˆ›å»ºtoastå…ƒç´ 
            const toast = document.createElement('div');
            toast.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
                color: white;
                padding: 15px 20px;
                border-radius: 8px;
                box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
                z-index: 10000;
                font-size: 1.1rem;
                font-weight: bold;
                text-align: center;
                transform: translateX(400px);
                transition: transform 0.3s ease;
                display: flex;
                align-items: center;
                gap: 10px;
            `;
            
            // æ·»åŠ å›¾æ ‡å’Œæ–‡æœ¬
            toast.innerHTML = `
                <span style="font-size: 1.5rem;">âœ…</span>
                <span>${message}</span>
            `;
            
            // æ·»åŠ åˆ°body
            document.body.appendChild(toast);
            
            // æ˜¾ç¤ºtoast
            setTimeout(() => {
                toast.style.transform = 'translateX(0)';
            }, 100);
            
            // 3ç§’åéšè—toast
            setTimeout(() => {
                toast.style.transform = 'translateX(400px)';
                setTimeout(() => {
                    document.body.removeChild(toast);
                }, 300);
            }, 3000);
        }
        
        // ä¿å­˜ä¹¦ç±åˆ°æœ¬åœ°å­˜å‚¨
        function saveBookToStorage(book) {
            try {
                // å®‰å…¨åœ°è¯»å–å’Œè§£æç°æœ‰ä¹¦ç±
                let books = [];
                const booksStr = localStorage.getItem('books');
                if (booksStr) {
                    try {
                        books = JSON.parse(booksStr);
                    } catch (parseError) {
                        console.error('saveBookToStorage - è§£ælocalStorageæ•°æ®å¤±è´¥ï¼Œé‡ç½®ä¸ºç©ºæ•°ç»„:', parseError);
                        books = [];
                    }
                }
                
                // ç¡®ä¿ä¹¦ç±åˆ—è¡¨æ˜¯æ•°ç»„
                if (!Array.isArray(books)) {
                    books = [];
                }
                
                // æ·»åŠ æ–°ä¹¦ç±
                books.push(book);
                
                // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
                localStorage.setItem('books', JSON.stringify(books));
                console.log('saveBookToStorage - ä¹¦ç±ä¿å­˜æˆåŠŸ:', book.title);
                return true;
            } catch (error) {
                console.error('saveBookToStorage é”™è¯¯:', error);
                
                // å°è¯•æ¸…ç†localStorageå¹¶é‡æ–°ä¿å­˜
                try {
                    console.log('saveBookToStorage - å°è¯•æ¸…ç†localStorageå¹¶é‡æ–°ä¿å­˜...');
                    localStorage.setItem('books', JSON.stringify([book]));
                    console.log('saveBookToStorage - æ¸…ç†åé‡æ–°ä¿å­˜æˆåŠŸ:', book.title);
                    return true;
                } catch (cleanupError) {
                    console.error('saveBookToStorage - æ¸…ç†åé‡æ–°ä¿å­˜å¤±è´¥:', cleanupError);
                    return false;
                }
            }
        }
        
        // æ›´æ–°æœ€è¿‘é˜…è¯»
        function updateRecentReading(book) {
            try {
                // å®‰å…¨åœ°è¯»å–å’Œè§£ææœ€è¿‘é˜…è¯»ä¹¦ç±
                let recentBooks = [];
                const recentBooksStr = localStorage.getItem('recentBooks');
                if (recentBooksStr) {
                    recentBooks = JSON.parse(recentBooksStr);
                }
                
                // ç¡®ä¿æœ€è¿‘é˜…è¯»åˆ—è¡¨æ˜¯æ•°ç»„
                if (!Array.isArray(recentBooks)) {
                    recentBooks = [];
                }
                
                // ç§»é™¤å·²å­˜åœ¨çš„ç›¸åŒä¹¦ç±ï¼ˆå¦‚æœæœ‰ï¼‰
                recentBooks = recentBooks.filter(b => b.id !== book.id);
                
                // æ·»åŠ åˆ°å¼€å¤´
                recentBooks.unshift(book);
                
                // åªä¿ç•™æœ€è¿‘4æœ¬
                recentBooks = recentBooks.slice(0, 4);
                
                // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
                localStorage.setItem('recentBooks', JSON.stringify(recentBooks));
                
                // æ›´æ–°æœ€è¿‘é˜…è¯»åŒºåŸŸ
                renderRecentReading();
                console.log('updateRecentReading - æœ€è¿‘é˜…è¯»æ›´æ–°æˆåŠŸ:', book.title);
            } catch (error) {
                console.error('updateRecentReading é”™è¯¯:', error);
            }
        }
        
        // æ¸²æŸ“æœ€è¿‘é˜…è¯»
        function renderRecentReading() {
            try {
                // å®‰å…¨åœ°è¯»å–å’Œè§£ææœ€è¿‘é˜…è¯»ä¹¦ç±
                let recentBooks = [];
                const recentBooksStr = localStorage.getItem('recentBooks');
                if (recentBooksStr) {
                    recentBooks = JSON.parse(recentBooksStr);
                }
                
                // ç¡®ä¿æœ€è¿‘é˜…è¯»åˆ—è¡¨æ˜¯æ•°ç»„
                if (!Array.isArray(recentBooks)) {
                    recentBooks = [];
                }
                
                const bookList = document.querySelector('.recent-reading .book-list');
                
                if (recentBooks.length === 0) {
                    bookList.innerHTML = '<p style="text-align: center; color: #888;">æš‚æ— æœ€è¿‘æ·»åŠ çš„ä¹¦ç±</p>';
                    return;
                }
                
                bookList.innerHTML = recentBooks.map(book => `
                    <div class="book-item">
                        <div class="book-cover" style="${book.coverUrl ? `background-image: url('${book.coverUrl}'); background-size: cover; background-position: center;` : `background: linear-gradient(90deg, #8b4513 0%, #a0522d 100%);`}">${!book.coverUrl ? book.title.charAt(0) : ''}</div>
                        <h3>${book.title}</h3>
                        <p class="book-author">${book.author} (${book.authorCountry})</p>
                        <span class="status-tag status-reading">å·²æ·»åŠ </span>
                    </div>
                `).join('');
                
                console.log('renderRecentReading - æœ€è¿‘é˜…è¯»æ¸²æŸ“æˆåŠŸ');
            } catch (error) {
                console.error('renderRecentReading é”™è¯¯:', error);
                const bookList = document.querySelector('.recent-reading .book-list');
                bookList.innerHTML = '<p style="text-align: center; color: #888;">æš‚æ— æœ€è¿‘æ·»åŠ çš„ä¹¦ç±</p>';
            }
        }
        
        // æ›´æ–°é˜…è¯»ç»Ÿè®¡
        function updateReadingStats() {
            try {
                // ä»localStorageè·å–ä¹¦ç±æ•°é‡ï¼Œç¡®ä¿ç»Ÿè®¡å‡†ç¡®
                let books = [];
                const booksStr = localStorage.getItem('books');
                if (booksStr) {
                    books = JSON.parse(booksStr);
                }
                
                // ç¡®ä¿ä¹¦ç±åˆ—è¡¨æ˜¯æ•°ç»„
                if (!Array.isArray(books)) {
                    books = [];
                }
                
                const bookCount = books.length;
                const statCard = document.querySelector('.stats-panel .stat-card:nth-child(1) .stat-value');
                if (statCard) {
                    statCard.textContent = bookCount;
                }
                console.log('updateReadingStats - é˜…è¯»ç»Ÿè®¡æ›´æ–°æˆåŠŸï¼Œå…±', bookCount, 'æœ¬ä¹¦');
            } catch (error) {
                console.error('updateReadingStats é”™è¯¯:', error);
            }
        }
        
        // ä»æœ¬åœ°å­˜å‚¨åŠ è½½æ‰€æœ‰ä¹¦ç±åˆ°ä¹¦æ¶
        function loadBooksFromStorage() {
            try {
                // å®‰å…¨åœ°è¯»å–å’Œè§£æä¹¦ç±
                let books = [];
                const booksStr = localStorage.getItem('books');
                if (booksStr) {
                    books = JSON.parse(booksStr);
                }
                
                // ç¡®ä¿ä¹¦ç±åˆ—è¡¨æ˜¯æ•°ç»„
                if (!Array.isArray(books)) {
                    books = [];
                }
                
                console.log('loadBooksFromStorage - ä»localStorageè¯»å–åˆ°', books.length, 'æœ¬ä¹¦ç±');
                
                const shelf = document.getElementById('main-shelf');
                
                // æ¸…ç©ºå½“å‰ä¹¦æ¶å†…å®¹ï¼ˆé™¤äº†ç©ºä¹¦æ¶æç¤ºï¼‰
                const emptyShelf = shelf.querySelector('.empty-shelf');
                if (emptyShelf) {
                    emptyShelf.remove();
                }
                
                // æ¸…ç©ºä¹¦æ¶å†…å®¹
                shelf.innerHTML = '';
                
                // é‡æ–°æ¸²æŸ“æ‰€æœ‰ä¹¦ç±
                books.forEach(book => {
                    // åˆ›å»ºä¹¦ç±å…ƒç´ 
                    const bookElement = document.createElement('div');
                    bookElement.className = 'classic-book';
                    bookElement.setAttribute('data-book-id', book.id);
                    
                    // ä½¿ç”¨å°é¢å›¾æˆ–é»˜è®¤æ ·å¼
                    if (book.coverUrl) {
                        bookElement.innerHTML = `
                            <div class="book-cover" style="background-image: url('${book.coverUrl}'); background-size: cover; background-position: center;"></div>
                            <div class="book-title">${book.title}</div>
                            <div class="book-actions">
                                <button class="book-action-btn edit-btn" onclick="editBook(${book.id})" title="ä¿®æ”¹">âœï¸</button>
                                <button class="book-action-btn delete-btn" onclick="deleteBook(${book.id})" title="åˆ é™¤">ğŸ—‘ï¸</button>
                            </div>
                        `;
                    } else {
                        // å¦åˆ™ä½¿ç”¨é»˜è®¤æ ·å¼
                        const bookColors = [
                            'linear-gradient(90deg, #8b4513 0%, #a0522d 100%)',
                            'linear-gradient(90deg, #4682b4 0%, #5a9bd5 100%)',
                            'linear-gradient(90deg, #2e8b57 0%, #3cb371 100%)',
                            'linear-gradient(90deg, #dc143c 0%, #ff1493 100%)',
                            'linear-gradient(90deg, #daa520 0%, #ffd700 100%)',
                            'linear-gradient(90deg, #800080 0%, #9932cc 100%)'
                        ];
                        const randomColor = bookColors[Math.floor(Math.random() * bookColors.length)];
                        const randomHeight = Math.floor(Math.random() * 40) + 150; // 150-190px
                        
                        bookElement.innerHTML = `
                            <div class="book-title">${book.title}</div>
                            <div class="book-actions">
                                <button class="book-action-btn edit-btn" onclick="editBook(${book.id})" title="ä¿®æ”¹">âœï¸</button>
                                <button class="book-action-btn delete-btn" onclick="deleteBook(${book.id})" title="åˆ é™¤">ğŸ—‘ï¸</button>
                            </div>
                        `;
                        bookElement.style.background = randomColor;
                        bookElement.style.height = `${randomHeight}px`;
                    }
                    
                    // æ·»åŠ ç‚¹å‡»äº‹ä»¶ï¼Œæ˜¾ç¤ºä¹¦ç±è¯¦ç»†ä¿¡æ¯
                    bookElement.addEventListener('click', function(e) {
                        // é¿å…æŒ‰é’®ç‚¹å‡»äº‹ä»¶è§¦å‘
                        if (!e.target.closest('.book-actions')) {
                            console.log('ç‚¹å‡»ä¹¦ç±ï¼Œæ˜¾ç¤ºè¯¦æƒ…ï¼ŒID:', book.id);
                            showBookDetails(book.id);
                        }
                    });
                    
                    // æ·»åŠ ä¹¦ç±åˆ°ä¹¦æ¶
                    shelf.appendChild(bookElement);
                });
                
                // å¦‚æœæ²¡æœ‰ä¹¦ç±ï¼Œæ˜¾ç¤ºç©ºä¹¦æ¶æç¤º
                if (books.length === 0) {
                    shelf.innerHTML = `
                        <div class="empty-shelf">
                            <p>ğŸ“š è¿™é‡Œè¿˜æ²¡æœ‰ä¹¦ç±</p>
                            <p>ä½¿ç”¨ä¸Šæ–¹æœç´¢æ¡†æ·»åŠ ä½ çš„ç¬¬ä¸€æœ¬ä¹¦</p>
                        </div>
                    `;
                } else {
                    // å¦‚æœæœ‰ä¹¦ç±ï¼Œæ›´æ–°æ·»åŠ ä¹¦ç±åŒºåŸŸçš„æ ‡é¢˜
                    const sectionTitle = document.querySelector('.add-book-section h3');
                    if (sectionTitle) {
                        sectionTitle.textContent = 'ç»§ç»­æ·»åŠ ä¹¦ç±';
                    }
                }
                
                console.log('loadBooksFromStorage - ä¹¦ç±åŠ è½½æˆåŠŸï¼Œå…±', books.length, 'æœ¬');
            } catch (error) {
                console.error('loadBooksFromStorage é”™è¯¯:', error);
                alert('ä¹¦ç±åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•ï¼');
            }
        }
        
        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        window.onload = function() {
            loadBooksFromStorage();
            renderRecentReading();
            updateReadingStats();
        };
        
        // è·å–ä¹¦ç±å¯¹è±¡
        function getBookById(bookId) {
            try {
                // å®‰å…¨åœ°è¯»å–å’Œè§£ælocalStorage
                let books = [];
                const booksStr = localStorage.getItem('books');
                if (booksStr) {
                    books = JSON.parse(booksStr);
                }
                
                console.log('getBookById - ä¹¦ç±åˆ—è¡¨:', books);
                console.log('getBookById - æŸ¥æ‰¾çš„ID:', bookId, 'ç±»å‹:', typeof bookId);
                
                // ç¡®ä¿ä¹¦ç±åˆ—è¡¨æ˜¯æ•°ç»„
                if (!Array.isArray(books)) {
                    books = [];
                }
                
                // å°è¯•å¤šç§åŒ¹é…æ–¹å¼ï¼Œç¡®ä¿èƒ½æ‰¾åˆ°ä¹¦ç±
                let book = null;
                
                // 1. ç›´æ¥åŒ¹é…ï¼ˆä¿æŒåŸæœ‰ç±»å‹ï¼‰
                book = books.find(book => book.id === bookId);
                console.log('getBookById - ç›´æ¥åŒ¹é…ç»“æœ:', book);
                
                // 2. å¦‚æœç›´æ¥åŒ¹é…å¤±è´¥ï¼Œå°è¯•è½¬æ¢ä¸ºæ•°å­—ç±»å‹åŒ¹é…
                if (!book) {
                    const idAsNumber = typeof bookId === 'string' ? parseInt(bookId) : bookId;
                    book = books.find(book => {
                        const bookIdNum = typeof book.id === 'string' ? parseInt(book.id) : book.id;
                        return bookIdNum === idAsNumber;
                    });
                    console.log('getBookById - æ•°å­—ç±»å‹åŒ¹é…ç»“æœ:', book);
                }
                
                // 3. å¦‚æœä»å¤±è´¥ï¼Œå°è¯•è½¬æ¢ä¸ºå­—ç¬¦ä¸²ç±»å‹åŒ¹é…
                if (!book) {
                    const idAsString = bookId.toString();
                    book = books.find(book => {
                        const bookIdStr = book.id.toString();
                        return bookIdStr === idAsString;
                    });
                    console.log('getBookById - å­—ç¬¦ä¸²ç±»å‹åŒ¹é…ç»“æœ:', book);
                }
                
                return book;
            } catch (error) {
                console.error('getBookById é”™è¯¯:', error);
                return null;
            }
        }
        
        // è¿™ä¸ªå‡½æ•°å·²è¢«ä¸‹æ–¹çš„å®Œæ•´å®ç°æ›¿ä»£ï¼Œä¿ç•™æ³¨é‡Šä»¥é¿å…å†²çª
        
        // åˆ é™¤ä¹¦ç±
        function deleteBook(bookId) {
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™æœ¬ä¹¦å—ï¼Ÿ')) {
                try {
                    // ä»æœ¬åœ°å­˜å‚¨ä¸­åˆ é™¤
                    let books = [];
                    const booksStr = localStorage.getItem('books');
                    if (booksStr) {
                        books = JSON.parse(booksStr);
                    }
                    
                    // ç¡®ä¿ä¹¦ç±åˆ—è¡¨æ˜¯æ•°ç»„
                    if (!Array.isArray(books)) {
                        books = [];
                    }
                    
                    books = books.filter(book => book.id !== bookId);
                    localStorage.setItem('books', JSON.stringify(books));
                    
                    // ä»ä¹¦æ¶ä¸­åˆ é™¤DOMå…ƒç´ 
                    const bookElement = document.querySelector(`[data-book-id="${bookId}"]`);
                    if (bookElement) {
                        bookElement.remove();
                    }
                    
                    // æ›´æ–°æœ€è¿‘é˜…è¯»
                    let recentBooks = [];
                    const recentBooksStr = localStorage.getItem('recentBooks');
                    if (recentBooksStr) {
                        recentBooks = JSON.parse(recentBooksStr);
                    }
                    
                    // ç¡®ä¿æœ€è¿‘é˜…è¯»åˆ—è¡¨æ˜¯æ•°ç»„
                    if (!Array.isArray(recentBooks)) {
                        recentBooks = [];
                    }
                    
                    recentBooks = recentBooks.filter(book => book.id !== bookId);
                    localStorage.setItem('recentBooks', JSON.stringify(recentBooks));
                    renderRecentReading();
                    
                    // æ›´æ–°é˜…è¯»ç»Ÿè®¡
                    updateReadingStats();
                    
                    // å¦‚æœä¹¦æ¶ä¸ºç©ºï¼Œæ˜¾ç¤ºç©ºä¹¦æ¶æç¤º
                    const shelf = document.getElementById('main-shelf');
                    if (shelf.children.length === 0) {
                        shelf.innerHTML = `
                            <div class="empty-shelf">
                                <p>ğŸ“š è¿™é‡Œè¿˜æ²¡æœ‰ä¹¦ç±</p>
                                <p>ä½¿ç”¨ä¸Šæ–¹æœç´¢æ¡†æ·»åŠ ä½ çš„ç¬¬ä¸€æœ¬ä¹¦</p>
                            </div>
                        `;
                        
                        // æ¢å¤æ·»åŠ ä¹¦ç±åŒºåŸŸçš„æ ‡é¢˜
                        const sectionTitle = document.querySelector('.add-book-section h3');
                        if (sectionTitle) {
                            sectionTitle.textContent = 'æ·»åŠ ä½ çš„ç¬¬ä¸€æœ¬ä¹¦';
                        }
                    }
                    
                    alert('ä¹¦ç±åˆ é™¤æˆåŠŸï¼');
                    console.log('deleteBook - ä¹¦ç±åˆ é™¤æˆåŠŸï¼ŒID:', bookId);
                } catch (error) {
                    console.error('deleteBook é”™è¯¯:', error);
                    alert('ä¹¦ç±åˆ é™¤å¤±è´¥ï¼Œè¯·é‡è¯•ï¼');
                }
            }
        }
        
        // æ˜¾ç¤ºä¹¦ç±è¯¦ç»†ä¿¡æ¯
        function showBookDetails(bookId) {
            const book = getBookById(bookId);
            if (!book) {
                alert('æœªæ‰¾åˆ°è¯¥ä¹¦ç±ï¼');
                return;
            }
            
            // åˆ›å»ºä¹¦ç±è¯¦æƒ…å¼¹çª—
            let popup = document.getElementById('bookDetailsPopup');
            if (!popup) {
                popup = document.createElement('div');
                popup.id = 'bookDetailsPopup';
                popup.className = 'book-details-popup';
                document.body.appendChild(popup);
            }
            
            // æ„å»ºä¹¦ç±è¯¦æƒ…HTMLï¼Œå±•ç¤ºæ‰€æœ‰ä¿¡æ¯
            popup.innerHTML = `
                <div class="book-details-content">
                    <div class="popup-header">
                        <h3>${book.title}</h3>
                        <button class="close-btn" id="closeDetailsPopupBtn">&times;</button>
                    </div>
                    <div class="book-details-body">
                        ${book.coverUrl ? `<div class="book-cover-large" style="background-image: url('${book.coverUrl}'); background-size: cover; background-position: center;"></div>` : ''}
                        <div class="book-info">
                            <p><strong>ä¹¦åï¼š</strong>${book.title}</p>
                            <p><strong>ä½œè€…ï¼š</strong>${book.author}</p>
                            <p><strong>ä½œè€…å›½ç±ï¼š</strong>${book.authorCountry}</p>
                            ${book.originalTitle ? `<p><strong>åŸä¹¦åï¼š</strong>${book.originalTitle}</p>` : '<p><strong>åŸä¹¦åï¼š</strong>æ— </p>'}
                            ${book.translator ? `<p><strong>è¯‘è€…ï¼š</strong>${book.translator}</p>` : '<p><strong>è¯‘è€…ï¼š</strong>æ— </p>'}
                            <p><strong>åˆ†ç±»ï¼š</strong>${getCategoryName(book.category)}</p>
                            <p><strong>æ·»åŠ æ—¶é—´ï¼š</strong>${new Date(book.addedAt).toLocaleString('zh-CN')}</p>
                            <div class="book-actions-popup">
                                <button class="edit-full-btn" onclick="openEditForm(${book.id})">âœï¸ ä¿®æ”¹ä¹¦ç±ä¿¡æ¯</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // æ˜¾ç¤ºå¼¹çª—
            popup.classList.add('active');
            
            // é˜²æ­¢èƒŒæ™¯æ»šåŠ¨
            document.body.classList.add('popup-open');
            
            // æ·»åŠ å…³é—­æŒ‰é’®äº‹ä»¶ç›‘å¬å™¨
            const closeBtn = document.getElementById('closeDetailsPopupBtn');
            if (closeBtn) {
                closeBtn.addEventListener('click', closeBookDetails);
            }
            
            // æ·»åŠ ç‚¹å‡»å¤–éƒ¨å…³é—­åŠŸèƒ½
            popup.onclick = function(e) {
                if (e.target === popup) {
                    closeBookDetails();
                }
            };
        }
        
        // æ‰“å¼€ç¼–è¾‘è¡¨å•
        function openEditForm(bookId) {
            const book = getBookById(bookId);
            if (!book) {
                alert('æœªæ‰¾åˆ°è¯¥ä¹¦ç±ï¼');
                return;
            }
            
            // åˆ›å»ºç¼–è¾‘è¡¨å•å¼¹çª—
            let popup = document.getElementById('editBookPopup');
            if (!popup) {
                popup = document.createElement('div');
                popup.id = 'editBookPopup';
                popup.className = 'book-details-popup';
                document.body.appendChild(popup);
            }
            
            // æ„å»ºç¼–è¾‘è¡¨å•HTML
            popup.innerHTML = `
                <div class="book-details-content">
                    <div class="popup-header">
                        <h3>ä¿®æ”¹ä¹¦ç±ä¿¡æ¯</h3>
                        <button class="close-btn" id="closeEditPopupBtn">&times;</button>
                    </div>
                    <div class="edit-form">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="edit-title">ä¹¦åï¼š</label>
                                <input type="text" id="edit-title" value="${book.title}" class="edit-input">
                            </div>
                            <div class="form-group">
                                <label for="edit-author">ä½œè€…ï¼š</label>
                                <input type="text" id="edit-author" value="${book.author}" class="edit-input">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="edit-author-country">ä½œè€…å›½ç±ï¼š</label>
                                <input type="text" id="edit-author-country" value="${book.authorCountry}" class="edit-input">
                            </div>
                            <div class="form-group">
                                <label for="edit-original-title">åŸä¹¦åï¼š</label>
                                <input type="text" id="edit-original-title" value="${book.originalTitle}" class="edit-input">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="edit-translator">è¯‘è€…ï¼š</label>
                                <input type="text" id="edit-translator" value="${book.translator}" class="edit-input">
                            </div>
                            <div class="form-group">
                                <label for="edit-category">åˆ†ç±»ï¼š</label>
                                <select id="edit-category" class="edit-input">
                                    <option value="literature" ${book.category === 'literature' ? 'selected' : ''}>æ–‡å­¦</option>
                                    <option value="history" ${book.category === 'history' ? 'selected' : ''}>å†å²</option>
                                    <option value="philosophy" ${book.category === 'philosophy' ? 'selected' : ''}>å“²å­¦</option>
                                    <option value="science" ${book.category === 'science' ? 'selected' : ''}>ç§‘å­¦</option>
                                    <option value="art" ${book.category === 'art' ? 'selected' : ''}>è‰ºæœ¯</option>
                                    <option value="other" ${book.category === 'other' ? 'selected' : ''}>å…¶ä»–</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group full-width">
                                <label for="edit-cover">ä¹¦ç±å°é¢å›¾ï¼ˆå¯é€‰ï¼Œæ”¯æŒ.jpg/.pngï¼‰ï¼š</label>
                                <div class="file-input-container">
                                    <input type="file" id="edit-cover" accept=".jpg,.png" class="file-input">
                                    <label for="edit-cover" class="file-input-label">é€‰æ‹©å°é¢å›¾</label>
                                </div>
                                <input type="hidden" id="edit-current-cover" value="${book.coverUrl || ''}">
                                ${book.coverUrl ? `<div class="current-cover" style="margin-top: 1rem;"><img src="${book.coverUrl}" alt="å½“å‰å°é¢" style="max-width: 100px; max-height: 150px; border: 2px solid #d4a76a; border-radius: 5px;"></div>` : ''}
                            </div>
                        </div>
                        <div class="form-actions">
                            <button type="button" class="cancel-btn" onclick="closeEditForm()">å–æ¶ˆ</button>
                            <button type="button" class="save-btn" onclick="saveBookChanges(${book.id})">ä¿å­˜ä¿®æ”¹</button>
                        </div>
                    </div>
                </div>
            `;
            
            // æ˜¾ç¤ºå¼¹çª—
            popup.classList.add('active');
            
            // é˜²æ­¢èƒŒæ™¯æ»šåŠ¨
            document.body.classList.add('popup-open');
            
            // æ·»åŠ å…³é—­æŒ‰é’®äº‹ä»¶ç›‘å¬å™¨
            const closeBtn = document.getElementById('closeEditPopupBtn');
            if (closeBtn) {
                closeBtn.addEventListener('click', closeEditForm);
            }
            
            // æ·»åŠ ç‚¹å‡»å¤–éƒ¨å…³é—­åŠŸèƒ½
            popup.onclick = function(e) {
                if (e.target === popup) {
                    closeEditForm();
                }
            };
        }
        
        // å…³é—­ç¼–è¾‘è¡¨å•
        function closeEditForm() {
            const popup = document.getElementById('editBookPopup');
            if (popup) {
                popup.classList.remove('active');
            }
            
            // å…è®¸èƒŒæ™¯æ»šåŠ¨
            document.body.classList.remove('popup-open');
        }
        
        // ä¿å­˜ä¹¦ç±ä¿®æ”¹
        function saveBookChanges(bookId) {
            // è·å–ä¿®æ”¹åçš„ä¿¡æ¯
            const title = document.getElementById('edit-title').value.trim();
            const author = document.getElementById('edit-author').value.trim();
            const authorCountry = document.getElementById('edit-author-country').value.trim();
            const originalTitle = document.getElementById('edit-original-title').value.trim();
            const translator = document.getElementById('edit-translator').value.trim();
            const category = document.getElementById('edit-category').value;
            const coverFile = document.getElementById('edit-cover').files[0];
            const currentCoverUrl = document.getElementById('edit-current-cover').value;
            
            // éªŒè¯å¿…å¡«é¡¹
            if (!title || !author || !authorCountry || !category) {
                alert('è¯·å¡«å†™å¿…å¡«å­—æ®µï¼šä¹¦åã€ä½œè€…ã€ä½œè€…å›½ç±å’Œåˆ†ç±»ï¼');
                return;
            }
            
            // å¤„ç†å°é¢å›¾
            if (coverFile) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const coverUrl = e.target.result;
                    updateBook(bookId, title, author, authorCountry, originalTitle, translator, category, coverUrl);
                };
                reader.readAsDataURL(coverFile);
            } else {
                // ä½¿ç”¨ç°æœ‰å°é¢å›¾
                updateBook(bookId, title, author, authorCountry, originalTitle, translator, category, currentCoverUrl);
            }
        }
        
        // æ›´æ–°ä¹¦ç±ä¿¡æ¯
        function updateBook(bookId, title, author, authorCountry, originalTitle, translator, category, coverUrl) {
            try {
                // ä»æœ¬åœ°å­˜å‚¨ä¸­è·å–ä¹¦ç±åˆ—è¡¨
                let books = [];
                const booksStr = localStorage.getItem('books');
                if (booksStr) {
                    books = JSON.parse(booksStr);
                }
                
                // ç¡®ä¿ä¹¦ç±åˆ—è¡¨æ˜¯æ•°ç»„
                if (!Array.isArray(books)) {
                    books = [];
                }
                
                const bookIndex = books.findIndex(book => book.id === bookId);
                
                if (bookIndex !== -1) {
                    // æ›´æ–°æœ¬åœ°å­˜å‚¨
                    const updatedBook = {
                        ...books[bookIndex],
                        title,
                        author,
                        authorCountry,
                        originalTitle,
                        translator,
                        category,
                        coverUrl
                    };
                    books[bookIndex] = updatedBook;
                    localStorage.setItem('books', JSON.stringify(books));
                    
                    // æ›´æ–°æœ€è¿‘é˜…è¯»
                    let recentBooks = [];
                    const recentBooksStr = localStorage.getItem('recentBooks');
                    if (recentBooksStr) {
                        recentBooks = JSON.parse(recentBooksStr);
                    }
                    
                    // ç¡®ä¿æœ€è¿‘é˜…è¯»åˆ—è¡¨æ˜¯æ•°ç»„
                    if (!Array.isArray(recentBooks)) {
                        recentBooks = [];
                    }
                    
                    const recentIndex = recentBooks.findIndex(book => book.id === bookId);
                    if (recentIndex !== -1) {
                        recentBooks[recentIndex] = updatedBook;
                        localStorage.setItem('recentBooks', JSON.stringify(recentBooks));
                        renderRecentReading();
                    }
                    
                    // æ›´æ–°ä¹¦æ¶æ˜¾ç¤º
                    updateBookDisplay(updatedBook);
                    
                    // å…³é—­ç¼–è¾‘è¡¨å•
                    closeEditForm();
                    
                    // å…³é—­è¯¦æƒ…å¼¹çª—ï¼ˆå¦‚æœæ‰“å¼€ï¼‰
                    closeBookDetails();
                    
                    alert('ä¹¦ç±ä¿¡æ¯ä¿®æ”¹æˆåŠŸï¼');
                    console.log('updateBook - ä¹¦ç±ä¿¡æ¯ä¿®æ”¹æˆåŠŸï¼ŒID:', bookId);
                }
            } catch (error) {
                console.error('updateBook é”™è¯¯:', error);
                alert('ä¹¦ç±ä¿¡æ¯ä¿®æ”¹å¤±è´¥ï¼Œè¯·é‡è¯•ï¼');
            }
        }
        
        // æ›´æ–°ä¹¦æ¶ä¸Šçš„ä¹¦ç±æ˜¾ç¤º
        function updateBookDisplay(book) {
            const bookElement = document.querySelector(`[data-book-id="${book.id}"]`);
            if (bookElement) {
                // é‡æ–°åˆ›å»ºä¹¦ç±å…ƒç´ HTML
                if (book.coverUrl) {
                    bookElement.innerHTML = `
                        <div class="book-cover" style="background-image: url('${book.coverUrl}'); background-size: cover; background-position: center;"></div>
                        <div class="book-title">${book.title}</div>
                        <div class="book-actions">
                            <button class="book-action-btn edit-btn" onclick="editBook(${book.id})" title="ä¿®æ”¹">âœï¸</button>
                            <button class="book-action-btn delete-btn" onclick="deleteBook(${book.id})" title="åˆ é™¤">ğŸ—‘ï¸</button>
                        </div>
                    `;
                } else {
                    // ä¿ç•™åŸæœ‰èƒŒæ™¯é¢œè‰²
                    const existingStyle = bookElement.style.background;
                    bookElement.innerHTML = `
                        <div class="book-title">${book.title}</div>
                        <div class="book-actions">
                            <button class="book-action-btn edit-btn" onclick="editBook(${book.id})" title="ä¿®æ”¹">âœï¸</button>
                            <button class="book-action-btn delete-btn" onclick="deleteBook(${book.id})" title="åˆ é™¤">ğŸ—‘ï¸</button>
                        </div>
                    `;
                    bookElement.style.background = existingStyle;
                }
                
                // é‡æ–°æ·»åŠ ç‚¹å‡»äº‹ä»¶
                bookElement.addEventListener('click', function(e) {
                    if (!e.target.closest('.book-actions')) {
                        showBookDetails(book.id);
                    }
                });
            }
        }
        
        // ä¿®æ”¹ä¹¦ç±ä¿¡æ¯
        function editBook(bookId) {
            // ç›´æ¥è°ƒç”¨ç¼–è¾‘è¡¨å•
            openEditForm(bookId);
        }
        
        // å…³é—­ä¹¦ç±è¯¦æƒ…å¼¹çª—
        function closeBookDetails() {
            const popup = document.getElementById('bookDetailsPopup');
            if (popup) {
                popup.classList.remove('active');
            }
            
            // å…è®¸èƒŒæ™¯æ»šåŠ¨
            document.body.classList.remove('popup-open');
        }
        
        // è·å–åˆ†ç±»åç§°
        function getCategoryName(categoryValue) {
            const categoryNames = {
                'literature': 'æ–‡å­¦',
                'history': 'å†å²',
                'philosophy': 'å“²å­¦',
                'science': 'ç§‘å­¦',
                'art': 'è‰ºæœ¯',
                'other': 'å…¶ä»–'
            };
            return categoryNames[categoryValue] || categoryValue;
        }
    </script>
</head>
<body>
    <!-- å¯¼èˆªæ  - ä¹¦æˆ¿ç»“æ„è®¾è®¡ -->
    <nav class="navbar">
        <div class="navbar-container">
            <a href="index.html" class="logo">ä¸ªäººé­”æ³•ä¹¦æˆ¿</a>
            <div class="menu-toggle" onclick="toggleMenu()">
                <div class="bar"></div>
                <div class="bar"></div>
                <div class="bar"></div>
            </div>
            <ul class="nav-links">
                <li><a href="index.html">æˆ‘çš„è—ä¹¦</a></li>
                <li><a href="atlas.html">ä¹¦ç±åœ°å›¾</a></li>
                <li><a href="notes.html">ä¸»é¢˜æœ­è®°</a></li>
                <li><a href="reading_challenge.html">é˜…è¯»æŒ‘æˆ˜</a></li>
                <li><a href="moments.html">ç¬é—´è®°å½•</a></li>
            </ul>
        </div>
    </nav>

    <!-- ä¸»å†…å®¹åŒº -->
    <div class="container">
        <h1>æ¬¢è¿æ¥åˆ°æˆ‘çš„ä¸ªäººä¹¦æˆ¿</h1>

        <!-- è™šæ‹Ÿä¹¦æˆ¿ - å“ˆåˆ©æ³¢ç‰¹å¼å¤å…¸ä¹¦æ¶ -->
        <section class="virtual-study">
            <h2>æˆ‘çš„é­”æ³•è—ä¹¦</h2>
            <p>æ¨å¼€é­”æ³•ä¹‹é—¨ï¼Œèµ°è¿›åªå±äºä½ çš„ä¼šç”Ÿé•¿çš„é­”æ³•ä¹¦æˆ¿</p>
            
            <!-- æ·»åŠ ä¹¦ç±æœç´¢æ¡† -->
            <div class="add-book-section">
                <h3>æ·»åŠ ä½ çš„ç¬¬ä¸€æœ¬ä¹¦</h3>
                <div class="book-form">
                    <div class="form-row">
                        <input type="text" id="book-title" placeholder="ä¹¦åï¼ˆå¿…å¡«ï¼‰" class="book-input" required>
                        <input type="text" id="book-author" placeholder="ä½œè€…ï¼ˆå¿…å¡«ï¼‰" class="book-input" required>
                    </div>
                    <div class="form-row">
                        <input type="text" id="book-author-country" placeholder="ä½œè€…å›½ç±ï¼ˆå¿…å¡«ï¼‰" class="book-input" required>
                        <div class="file-input-container">
                            <input type="file" id="book-cover" accept=".jpg,.png" class="book-input file-input" required>
                            <label for="book-cover" class="file-input-label">ä¹¦ç±å°é¢å›¾ï¼ˆå¿…å¡«ï¼Œæ”¯æŒ.jpg/.pngï¼‰</label>
                        </div>
                    </div>
                    <div class="form-row">
                        <select id="book-category" class="book-input" required>
                            <option value="">é€‰æ‹©åˆ†ç±»ï¼ˆå¿…å¡«ï¼‰</option>
                            <option value="literature">æ–‡å­¦</option>
                            <option value="history">å†å²</option>
                            <option value="philosophy">å“²å­¦</option>
                            <option value="science">ç§‘å­¦</option>
                            <option value="art">è‰ºæœ¯</option>
                            <option value="other">å…¶ä»–</option>
                        </select>
                    </div>
                    <div class="form-row">
                        <input type="text" id="book-original-title" placeholder="åŸä¹¦åï¼ˆé€‰å¡«ï¼‰" class="book-input">
                        <input type="text" id="book-translator" placeholder="è¯‘è€…ï¼ˆé€‰å¡«ï¼‰" class="book-input">
                    </div>
                    <button onclick="addBook()" class="add-book-btn">âœ¨ æ·»åŠ ä¹¦ç±</button>
                </div>
                <p class="search-hint">å¡«å†™ä¹¦ç±ä¿¡æ¯ï¼Œè®©å®ƒå‡ºç°åœ¨ä½ çš„é­”æ³•ä¹¦æ¶ä¸Š</p>
            </div>
            
            <!-- å•ä¸€å·¨å¤§çš„å“ˆåˆ©æ³¢ç‰¹å¼ä¹¦æ¶ -->
            <div class="giant-harry-potter-library">
                <!-- ä¹¦æ¶è£…é¥°å…ƒç´  -->
                <div class="library-decoration">
                    <div class="floating-candles">
                        <div class="candle" style="left: 10%; top: 10%;"></div>
                        <div class="candle" style="left: 30%; top: 15%;"></div>
                        <div class="candle" style="right: 30%; top: 10%;"></div>
                        <div class="candle" style="right: 10%; top: 15%;"></div>
                        <div class="candle" style="left: 20%; top: 5%;"></div>
                        <div class="candle" style="right: 20%; top: 8%;"></div>
                        <div class="candle" style="left: 40%; top: 12%;"></div>
                        <div class="candle" style="right: 40%; top: 12%;"></div>
                    </div>
                    
                    <div class="ladder" style="left: 5%; bottom: 0;"></div>
                    <div class="owl" style="right: 10%; top: 20%;">ğŸ¦‰</div>
                    <div class="old-map" style="left: 15%; bottom: 20%;">ğŸ—ºï¸</div>
                    <div class="magic-scroll" style="right: 15%; bottom: 30%;">ğŸ“œ</div>
                </div>
                
                <!-- å·¨å¤§ä¹¦æ¶ä¸»ä½“ -->
                <div class="giant-bookshelf">
                    <!-- ä¹¦æ¶æ ¼å­ -->
                    <div class="bookshelf-grid" id="main-shelf">
                        <!-- ä¹¦ç±å°†é€šè¿‡JavaScriptåŠ¨æ€æ·»åŠ  -->
                        <div class="empty-shelf">
                            <p>ğŸ“š è¿™é‡Œè¿˜æ²¡æœ‰ä¹¦ç±</p>
                            <p>ä½¿ç”¨ä¸Šæ–¹æœç´¢æ¡†æ·»åŠ ä½ çš„ç¬¬ä¸€æœ¬ä¹¦</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- å¿«é€Ÿè®¿é—®åŒºåŸŸ -->
        <section class="quick-access">
            <h2>å¿«é€Ÿè®¿é—®</h2>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                <a href="books.html" class="btn">ç®¡ç†ä¹¦ç±</a>
            </div>
        </section>

        <!-- é˜…è¯»ç»Ÿè®¡ -->
        <section class="stats-panel">
            <h2>é˜…è¯»ç»Ÿè®¡</h2>
            <div class="stats-panel">
                <div class="stat-card">
                    <div class="stat-value">0</div>
                    <div class="stat-label">ä¹¦æ¶ä¹¦ç±æ•°é‡</div>
                </div>
            </div>
        </section>

        <!-- æœ€è¿‘é˜…è¯» -->
        <section class="recent-reading">
            <h2>æœ€è¿‘æ·»åŠ </h2>
            <div class="book-list">
                <p style="text-align: center; color: #888;">æš‚æ— æœ€è¿‘æ·»åŠ çš„ä¹¦ç±</p>
            </div>
        </section>
    </div>

    <!-- é¡µè„š -->
    <footer>
        <p>&copy; 2025 ä¸ªäººä¹¦æˆ¿. ä¿ç•™æ‰€æœ‰æƒåˆ©.</p>
    </footer>

    <!-- æ»šåŠ¨åˆ°é¡¶éƒ¨æŒ‰é’® -->
    <button class="scroll-top-btn" onclick="window.scrollTo({top: 0, behavior: 'smooth'})">&uarr;</button>
</body>
</html>