<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Arcane Study - Moments</title>
    <link rel="stylesheet" href="style.css">
    <style>
        /* ç¬é—´è®°å½•é¡µé¢ä¸“ç”¨æ ·å¼ */
        .moments-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 2rem;
            font-family: 'Georgia', serif;
            background-color: #faf9f7;
            min-height: 100vh;
        }

        .moments-title {
            font-size: 2.5rem;
            color: #3a3a3a;
            text-align: center;
            margin-bottom: 3rem;
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }

        /* å‘å¸ƒç¬é—´åŒºåŸŸ */
        .post-moment-section {
            background: white;
            background-image: url('images/Notes-taking.png');
            background-size: cover;
            background-position: center;
            position: relative;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
            overflow: hidden;
        }
        
        /* æ·»åŠ æ·±è‰²åŠé€æ˜é®ç½© */
        .post-moment-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6); /* æ·±è‰²åŠé€æ˜é®ç½© */
            z-index: 1;
        }
        
        /* ç¡®ä¿å†…å®¹åœ¨é®ç½©ä¹‹ä¸Š */
        .post-moment-section > * {
            position: relative;
            z-index: 2;
        }

        .moment-input {
            width: 100%;
            min-height: 120px;
            padding: 1rem;
            border: 2px solid #d4b896;
            border-radius: 8px;
            background: rgba(248, 246, 242, 0.95);
            color: #3a2f1e;
            font-size: 1.1rem;
            font-family: 'Georgia', serif;
            resize: vertical;
            margin-bottom: 1rem;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .moment-input::placeholder {
            color: #a0937d;
            font-style: italic;
        }

        .attachments {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .attachment-btn {
            background: rgba(240, 237, 231, 0.95);
            color: #5a4430;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .attachment-btn:hover {
            background: #d4b896;
            transform: translateY(-2px);
        }

        .post-btn {
            background: rgba(212, 184, 150, 0.95);
            color: #5a4430;
            border: none;
            padding: 1rem 2rem;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            transition: all 0.3s ease;
            width: 100%;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .post-btn:hover {
            background: #c19a6b;
            transform: translateY(-2px) scale(1.02);
        }

        /* ç¬é—´åˆ—è¡¨ */
        .moments-list {
            display: flex;
            flex-direction: column;
            gap: 2rem;
        }

        /* ç¬é—´å¡ç‰‡ */
        .moment-card {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        .moment-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
        }

        .moment-content {
            font-size: 1.1rem;
            color: #3a2f1e;
            line-height: 1.8;
            margin-bottom: 1rem;
            white-space: pre-wrap;
        }

        .moment-image {
            max-width: 100%;
            border-radius: 8px;
            margin-bottom: 1rem;
            display: block;
            margin-left: auto;
            margin-right: auto;
        }

        .moment-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.9rem;
            color: #a0937d;
        }

        .delete-btn {
            background: transparent;
            color: #a0937d;
            border: none;
            cursor: pointer;
            font-size: 0.9rem;
            padding: 0.3rem 0.8rem;
            border-radius: 15px;
            transition: all 0.3s ease;
        }

        .delete-btn:hover {
            background: #f0ede7;
            color: #5a4430;
        }

        /* éšè—æ–‡ä»¶è¾“å…¥ */
        .file-input {
            display: none;
        }

        /* é¢„è§ˆå›¾ç‰‡ */
        .image-preview {
            max-width: 100%;
            max-height: 300px;
            border-radius: 8px;
            margin-bottom: 1rem;
            display: block;
        }
    </style>
</head>
<body>
    <!-- å¯¼èˆªæ  -->
    <nav class="navbar">
        <div class="navbar-container">
            <a href="index.html" class="logo">ä¸ªäººé­”æ³•ä¹¦æˆ¿</a>
            <div class="menu-toggle" onclick="toggleMenu()">
                <div class="bar"></div>
                <div class="bar"></div>
                <div class="bar"></div>
            </div>
            <ul class="nav-links">
                <li><a href="index.html">æˆ‘çš„è—ä¹¦</a></li>
                <li><a href="atlas.html">ä¹¦ç±åœ°å›¾</a></li>
                <li><a href="notes.html">ä¸»é¢˜æœ­è®°</a></li>
                <li><a href="reading_challenge.html">é˜…è¯»æŒ‘æˆ˜</a></li>
                <li><a href="moments.html">ç¬é—´è®°å½•</a></li>
            </ul>
        </div>
    </nav>

    <!-- ä¸»å†…å®¹åŒº -->
    <div class="moments-container">
        <h1 class="moments-title">ç¬é—´è®°å½•</h1>
        
        <!-- å‘å¸ƒç¬é—´åŒºåŸŸ -->
        <section class="post-moment-section">
            <textarea 
                class="moment-input" 
                placeholder="ä»Šå¤©è¯»åˆ°ä¸€å¥éœ‡æ’¼çš„è¯â€¦â€¦" 
                id="momentText"
            ></textarea>
            
            <div class="attachments">
                <label class="attachment-btn" for="imageUpload">
                    ğŸ“· å›¾ç‰‡
                </label>
                <input type="file" id="imageUpload" class="file-input" accept="image/*" capture="">
            </div>
            
            <!-- å›¾ç‰‡é¢„è§ˆ -->
            <div id="imagePreview" class="image-preview-container"></div>
            
            <button class="post-btn" onclick="postMoment()">å‘å¸ƒ</button>
        </section>
        
        <!-- ç¬é—´åˆ—è¡¨ -->
        <section class="moments-list" id="momentsList">
            <!-- ç¬é—´å¡ç‰‡å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
        </section>
    </div>

    <!-- é¡µè„š -->
    <footer>
        <p>&copy; 2025 The Arcane Study. ä¿ç•™æ‰€æœ‰æƒåˆ©.</p>
    </footer>

    <script>
        // ç§»åŠ¨ç«¯èœå•åˆ‡æ¢
        function toggleMenu() {
            const navLinks = document.querySelector('.nav-links');
            navLinks.classList.toggle('active');
        }
        
        // ä»æœ¬åœ°å­˜å‚¨åŠ è½½ç¬é—´
        function loadMoments() {
            const saved = localStorage.getItem('readingMoments');
            return saved ? JSON.parse(saved) : [];
        }
        
        // ä¿å­˜ç¬é—´åˆ°æœ¬åœ°å­˜å‚¨
        function saveMoments(moments) {
            localStorage.setItem('readingMoments', JSON.stringify(moments));
        }
        
        // æ ¼å¼åŒ–æ—¶é—´
        function formatTime(timestamp) {
            const now = new Date();
            const momentDate = new Date(timestamp);
            const diffTime = Math.abs(now - momentDate);
            const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
            
            if (diffDays === 0) {
                return `ä»Šå¤© ${momentDate.toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit' })}`;
            } else if (diffDays === 1) {
                return `æ˜¨å¤© ${momentDate.toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit' })}`;
            } else {
                return momentDate.toLocaleDateString('zh-CN') + ' ' + momentDate.toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit' });
            }
        }
        
        // æ¸²æŸ“ç¬é—´åˆ—è¡¨
        function renderMoments() {
            const moments = loadMoments();
            const container = document.getElementById('momentsList');
            
            if (moments.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 3rem; background: #f8f6f2; border-radius: 12px; color: #a0937d;">
                        <p style="font-size: 1.2rem; margin-bottom: 0.5rem;">æš‚æ— ç¬é—´è®°å½•</p>
                        <p>å¼€å§‹è®°å½•ä½ çš„é˜…è¯»ç¬é—´å§</p>
                    </div>
                `;
                return;
            }
            
            // æŒ‰æ—¶é—´å€’åºæ’åˆ—
            moments.sort((a, b) => b.timestamp - a.timestamp);
            
            container.innerHTML = moments.map(moment => `
                <div class="moment-card" data-id="${moment.id}">
                    <div class="moment-content">${moment.content}</div>
                    ${moment.image ? `<img src="${moment.image}" alt="ç¬é—´å›¾ç‰‡" class="moment-image">` : ''}
                    <div class="moment-footer">
                        <span>${formatTime(moment.timestamp)}</span>
                        <button class="delete-btn" onclick="deleteMoment(${moment.id})">åˆ é™¤</button>
                    </div>
                </div>
            `).join('');
        }
        
        // å‘å¸ƒç¬é—´
        function postMoment() {
            const content = document.getElementById('momentText').value.trim();
            const imageInput = document.getElementById('imageUpload');
            
            if (!content) {
                alert('è¯·è¾“å…¥ç¬é—´å†…å®¹ï¼');
                return;
            }
            
            // å¤„ç†å›¾ç‰‡
            let imageData = null;
            if (imageInput.files.length > 0) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    imageData = e.target.result;
                    processMoment(content, imageData);
                };
                reader.onerror = function() {
                    alert('å›¾ç‰‡å¤„ç†å¤±è´¥ï¼Œè¯·é‡è¯•');
                };
                reader.readAsDataURL(imageInput.files[0]);
                return;
            }
            
            // åªå¤„ç†æ–‡æœ¬
            processMoment(content, null);
        }
        
        // å¤„ç†ç¬é—´æ•°æ®
        function processMoment(content, image) {
            const moments = loadMoments();
            const newMoment = {
                id: Date.now(),
                content: content,
                image: image,
                timestamp: Date.now()
            };
            
            moments.push(newMoment);
            saveMoments(moments);
            
            // é‡ç½®è¡¨å•
            document.getElementById('momentText').value = '';
            document.getElementById('imageUpload').value = '';
            document.getElementById('imagePreview').innerHTML = '';
            
            // é‡æ–°æ¸²æŸ“åˆ—è¡¨
            renderMoments();
        }
        
        // åˆ é™¤ç¬é—´
        function deleteMoment(id) {
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™æ¡ç¬é—´å—ï¼Ÿ')) {
                let moments = loadMoments();
                moments = moments.filter(moment => moment.id !== id);
                saveMoments(moments);
                renderMoments();
            }
        }
        
        // å›¾ç‰‡é¢„è§ˆ - ç¡®ä¿å›¾ç‰‡ä¸Šä¼ åç«‹å³æ˜¾ç¤º
        document.getElementById('imageUpload').addEventListener('change', function(e) {
            const preview = document.getElementById('imagePreview');
            preview.innerHTML = '';
            
            if (e.target.files.length > 0) {
                const file = e.target.files[0];
                const reader = new FileReader();
                reader.onload = function(e) {
                    const img = document.createElement('img');
                    img.src = e.target.result;
                    img.className = 'image-preview';
                    preview.appendChild(img);
                };
                reader.readAsDataURL(file);
            }
        });
        
        // é¡µé¢åŠ è½½æ—¶æ¸²æŸ“ç¬é—´åˆ—è¡¨
        document.addEventListener('DOMContentLoaded', renderMoments);
    </script>
</body>
</html>
