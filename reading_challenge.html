<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Arcane Study - Reading Challenge</title>
    <link rel="stylesheet" href="style.css">
    <style>
        /* é˜…è¯»æŒ‘æˆ˜é¡µé¢å¤´éƒ¨èƒŒæ™¯å›¾æ ·å¼ */
        .challenge-header {
            background-image: url('images/Reading Desk.jpg');
            background-size: cover;
            background-position: center;
            position: relative;
            margin: -2rem -2rem 2rem -2rem;
            padding: 2rem;
            border-radius: 8px 8px 0 0;
            overflow: hidden;
        }
        
        /* æ·»åŠ æ·±è‰²åŠé€æ˜é®ç½© */
        .challenge-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6); /* æ·±è‰²åŠé€æ˜é®ç½© */
            z-index: 1;
        }
        
        /* ç¡®ä¿å¤´éƒ¨å†…å®¹åœ¨é®ç½©ä¹‹ä¸Š */
        .challenge-header > * {
            position: relative;
            z-index: 2;
        }
    </style>
</head>
<body>
    <!-- å¯¼èˆªæ  -->
    <nav class="navbar">
        <div class="navbar-container">
            <a href="index.html" class="logo">ä¸ªäººé­”æ³•ä¹¦æˆ¿</a>
            <div class="menu-toggle" onclick="toggleMenu()">
                <div class="bar"></div>
                <div class="bar"></div>
                <div class="bar"></div>
            </div>
            <ul class="nav-links">
                <li><a href="index.html">æˆ‘çš„è—ä¹¦</a></li>
                <li><a href="atlas.html">ä¹¦ç±åœ°å›¾</a></li>
                <li><a href="notes.html">ä¸»é¢˜æœ­è®°</a></li>
                <li><a href="reading_challenge.html">é˜…è¯»æŒ‘æˆ˜</a></li>
                <li><a href="moments.html">ç¬é—´è®°å½•</a></li>
            </ul>
        </div>
    </nav>

    <!-- ä¸»å†…å®¹åŒº -->
    <div class="container">
        <!-- æŒ‘æˆ˜å¤´éƒ¨åŒºåŸŸ - å¸¦æœ‰èƒŒæ™¯å›¾å’Œé®ç½© -->
        <div class="challenge-header">
            <!-- é¡¶éƒ¨æ ‡é¢˜åŒº -->
            <header style="text-align: center; margin-bottom: 2rem;">
                <h1>é˜…è¯»æŒ‘æˆ˜</h1>
                <p style="color: #d4a76a; font-style: italic;">é€‰æ‹©ä½ æƒ³å‚åŠ çš„æŒ‘æˆ˜</p>
            </header>
            
            <!-- ç­›é€‰æ ‡ç­¾ -->
            <div style="display: flex; justify-content: center; margin-bottom: 2rem; gap: 1rem;">
                <div class="filter-tab active" data-filter="all" style="padding: 0.8rem 1.5rem; background: linear-gradient(135deg, #d4a76a 0%, #8b4513 100%); color: #3a2f1e; border-radius: 8px; cursor: pointer; font-weight: bold; transition: all 0.3s ease; border: 2px solid #8b4513;">å…¨éƒ¨</div>
                <div class="filter-tab" data-filter="in-progress" style="padding: 0.8rem 1.5rem; background: rgba(244, 228, 188, 0.9); color: #3a2f1e; border-radius: 8px; cursor: pointer; font-weight: bold; transition: all 0.3s ease; border: 2px solid #8b4513;">è¿›è¡Œä¸­</div>
                <div class="filter-tab" data-filter="completed" style="padding: 0.8rem 1.5rem; background: rgba(244, 228, 188, 0.9); color: #3a2f1e; border-radius: 8px; cursor: pointer; font-weight: bold; transition: all 0.3s ease; border: 2px solid #8b4513;">å·²å®Œæˆ</div>
                <div class="filter-tab" data-filter="available" style="padding: 0.8rem 1.5rem; background: rgba(244, 228, 188, 0.9); color: #3a2f1e; border-radius: 8px; cursor: pointer; font-weight: bold; transition: all 0.3s ease; border: 2px solid #8b4513;">å¯å‚åŠ </div>
            </div>
        </div>
        
        <!-- æ¨¡æ€æ¡† - å‚åŠ æŒ‘æˆ˜è¾“å…¥ -->
        <div id="joinModal" style="display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5);">
            <div style="background-color: #f4e4bc; margin: 15% auto; padding: 2rem; border-radius: 8px; width: 80%; max-width: 500px; position: relative;">
                <span id="closeModal" style="position: absolute; right: 1rem; top: 1rem; font-size: 1.5rem; cursor: pointer;">&times;</span>
                <h3 id="modalTitle" style="margin-bottom: 1rem;"></h3>
                <p id="modalDescription" style="margin-bottom: 1.5rem; color: #8b4513;"></p>
                <div id="modalInputSection" style="margin-bottom: 1.5rem;">
                    <label id="modalLabel" style="display: block; margin-bottom: 0.5rem; font-weight: bold; color: #8b4513;"></label>
                    <input type="text" id="modalInput" style="width: 100%; padding: 0.8rem; border: 2px solid #d4a76a; border-radius: 8px; font-family: 'Georgia', serif; color: #3a2f1e;">
                    <div id="modalError" style="color: #c1121f; font-size: 0.9rem; margin-top: 0.5rem;"></div>
                </div>
                <div style="display: flex; gap: 1rem; justify-content: flex-end;">
                    <button id="cancelJoin" style="padding: 0.8rem 1.5rem; background: rgba(244, 228, 188, 0.9); color: #3a2f1e; border: 2px solid #8b4513; border-radius: 8px; cursor: pointer; font-weight: bold; transition: all 0.3s ease; font-family: 'Georgia', serif;">å–æ¶ˆ</button>
                    <button id="confirmJoin" style="padding: 0.8rem 1.5rem; background: linear-gradient(135deg, #d4a76a 0%, #8b4513 100%); color: #3a2f1e; border: 2px solid #8b4513; border-radius: 8px; cursor: pointer; font-weight: bold; transition: all 0.3s ease; font-family: 'Georgia', serif;">ç¡®è®¤å‚åŠ </button>
                </div>
            </div>
        </div>
        
        <!-- æŒ‘æˆ˜å¡ç‰‡åˆ—è¡¨ -->
        <div class="challenge-grid" id="challengeGrid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)); gap: 1.5rem;"></div>
    </div>

    <!-- é¡µè„š -->
    <footer>
        <p>&copy; 2025 The Arcane Study. ä¿ç•™æ‰€æœ‰æƒåˆ©.</p>
    </footer>

    <script>
        // ç³»ç»Ÿæ¨èæŒ‘æˆ˜ï¼ˆå¸¸é‡ï¼Œä¸å­˜å…¥localStorageï¼‰
        const presetChallenges = [
            {
                id: 1,
                title: "æœˆåº¦ä¸»é¢˜æ¢ç´¢",
                description: "æ¯æœˆæ¢ç´¢ä¸€ä¸ªç‰¹å®šä¸»é¢˜",
                difficulty: "ä¸­ç­‰",
                duration: "30å¤©",
                bookCount: 3,
                status: "available",
                type: "theme"
            },
            {
                id: 2,
                title: "ä½œè€…æ·±åº¦é˜…è¯»",
                description: "æ·±å…¥é˜…è¯»ä¸€ä½ä½œè€…çš„ä½œå“",
                difficulty: "å›°éš¾",
                duration: "60å¤©",
                bookCount: 5,
                status: "available",
                type: "author"
            },
            {
                id: 3,
                title: "å¿«é€Ÿé˜…è¯»æŒ‘æˆ˜",
                description: "å‘¨æœ«è¯»å®Œä¸€æœ¬ä¹¦",
                difficulty: "ç®€å•",
                duration: "3å¤©",
                bookCount: 1,
                status: "available",
                type: "speed"
            }
        ];

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // ä»localStorageè·å–ç”¨æˆ·æŒ‘æˆ˜æ•°æ®
            let userChallenges = JSON.parse(localStorage.getItem('userChallenges')) || [];
            
            // åˆå§‹åŒ–ç”¨æˆ·æŒ‘æˆ˜ï¼ˆå¦‚æœä¸ºç©ºï¼‰
            if (!Array.isArray(userChallenges)) {
                userChallenges = [];
                localStorage.setItem('userChallenges', JSON.stringify(userChallenges));
            }
            
            // æ›´æ–°æŒ‘æˆ˜çŠ¶æ€ï¼ˆæ£€æŸ¥æ˜¯å¦è¶…æ—¶ï¼‰
            updateChallengeStatuses(userChallenges);
            
            // æ¸²æŸ“æŒ‘æˆ˜åˆ—è¡¨
            renderChallenges(presetChallenges, userChallenges);
            
            // æ¨¡æ€æ¡†å…ƒç´ 
            const joinModal = document.getElementById('joinModal');
            const closeModal = document.getElementById('closeModal');
            const cancelJoin = document.getElementById('cancelJoin');
            const confirmJoin = document.getElementById('confirmJoin');
            const modalInput = document.getElementById('modalInput');
            const modalError = document.getElementById('modalError');
            let currentChallenge = null;
            
            // å…³é—­æ¨¡æ€æ¡†
            function hideModal() {
                joinModal.style.display = 'none';
                modalInput.value = '';
                modalError.textContent = '';
                modalInput.style.borderColor = '#d4a76a';
                currentChallenge = null;
            }
            
            // å…³é—­æ¨¡æ€æ¡†äº‹ä»¶
            closeModal.addEventListener('click', hideModal);
            cancelJoin.addEventListener('click', hideModal);
            
            // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
            window.addEventListener('click', function(event) {
                if (event.target === joinModal) {
                    hideModal();
                }
            });
            
            // ç¡®è®¤å‚åŠ æŒ‘æˆ˜
            confirmJoin.addEventListener('click', function() {
                const inputValue = modalInput.value.trim();
                
                // éªŒè¯è¾“å…¥
                if (!inputValue) {
                    modalError.textContent = 'è¯·è¾“å…¥å¿…å¡«ä¿¡æ¯ï¼';
                    modalInput.style.borderColor = '#c1121f';
                    return;
                }
                
                // åˆ›å»ºç”¨æˆ·æŒ‘æˆ˜å¯¹è±¡
                const startDate = new Date();
                const deadline = new Date();
                const durationDays = parseInt(currentChallenge.duration.replace(/[^0-9]/g, ''));
                deadline.setDate(startDate.getDate() + durationDays);
                
                const newUserChallenge = {
                    id: Date.now(), // ä½¿ç”¨æ—¶é—´æˆ³ä½œä¸ºå”¯ä¸€ID
                    challengeId: currentChallenge.id, // ä¿ç•™é¢„è®¾æŒ‘æˆ˜IDç”¨äºå…³è”
                    title: currentChallenge.title,
                    description: currentChallenge.description,
                    difficulty: currentChallenge.difficulty,
                    duration: currentChallenge.duration,
                    bookCount: currentChallenge.bookCount,
                    type: currentChallenge.type,
                    customValue: inputValue,
                    status: 'active',
                    books: [],
                    createdAt: startDate.toISOString(),
                    deadline: deadline.toISOString(),
                    updatedAt: startDate.toISOString()
                };
                
                // æ·»åŠ åˆ°ç”¨æˆ·æŒ‘æˆ˜åˆ—è¡¨
                userChallenges.push(newUserChallenge);
                
                // ä¿å­˜åˆ°localStorage
                localStorage.setItem('userChallenges', JSON.stringify(userChallenges));
                
                // éšè—æ¨¡æ€æ¡†
                hideModal();
                
                // é‡æ–°æ¸²æŸ“æŒ‘æˆ˜åˆ—è¡¨
                renderChallenges(presetChallenges, userChallenges, document.querySelector('.filter-tab.active').dataset.filter);
            });
            
            // å‚åŠ æŒ‘æˆ˜
            window.joinChallenge = function(challengeId) {
                // æ‰¾åˆ°è¦å‚åŠ çš„æŒ‘æˆ˜
                const challengeToJoin = presetChallenges.find(ch => ch.id === challengeId);
                if (challengeToJoin) {
                    currentChallenge = challengeToJoin;
                    
                    // è®¾ç½®æ¨¡æ€æ¡†å†…å®¹
                    document.getElementById('modalTitle').textContent = challengeToJoin.title;
                    document.getElementById('modalDescription').textContent = challengeToJoin.description;
                    
                    // æ ¹æ®æŒ‘æˆ˜ç±»å‹è®¾ç½®è¾“å…¥æç¤º
                    if (challengeToJoin.type === 'author') {
                        document.getElementById('modalLabel').textContent = 'è¯·è¾“å…¥ä½œè€…å§“å';
                        document.getElementById('modalInput').placeholder = 'ä¾‹å¦‚ï¼šåŠ è¥¿äºšÂ·é©¬å°”å…‹æ–¯';
                    } else if (challengeToJoin.type === 'theme') {
                        document.getElementById('modalLabel').textContent = 'è¯·è¾“å…¥æœ¬æ¬¡é˜…è¯»ä¸»é¢˜';
                        document.getElementById('modalInput').placeholder = 'ä¾‹å¦‚ï¼šå¥³æ€§æ–‡å­¦ã€æ‹‰ç¾æ–‡å­¦';
                    } else {
                        // å¿«é€Ÿé˜…è¯»æŒ‘æˆ˜ä¸éœ€è¦é¢å¤–è¾“å…¥
                        const startDate = new Date();
                        const deadline = new Date();
                        const durationDays = parseInt(challengeToJoin.duration.replace(/[^0-9]/g, ''));
                        deadline.setDate(startDate.getDate() + durationDays);
                        
                        const newUserChallenge = {
                            id: Date.now(), // ä½¿ç”¨æ—¶é—´æˆ³ä½œä¸ºå”¯ä¸€ID
                            challengeId: challengeToJoin.id, // ä¿ç•™é¢„è®¾æŒ‘æˆ˜IDç”¨äºå…³è”
                            title: challengeToJoin.title,
                            description: challengeToJoin.description,
                            difficulty: challengeToJoin.difficulty,
                            duration: challengeToJoin.duration,
                            bookCount: challengeToJoin.bookCount,
                            type: challengeToJoin.type,
                            status: 'active',
                            books: [],
                            createdAt: startDate.toISOString(),
                            deadline: deadline.toISOString(),
                            updatedAt: startDate.toISOString()
                        };
                        
                        // æ·»åŠ åˆ°ç”¨æˆ·æŒ‘æˆ˜åˆ—è¡¨
                        userChallenges.push(newUserChallenge);
                        
                        // ä¿å­˜åˆ°localStorage
                        localStorage.setItem('userChallenges', JSON.stringify(userChallenges));
                        
                        // é‡æ–°æ¸²æŸ“æŒ‘æˆ˜åˆ—è¡¨
                        renderChallenges(presetChallenges, userChallenges, document.querySelector('.filter-tab.active').dataset.filter);
                        return;
                    }
                    
                    // æ˜¾ç¤ºæ¨¡æ€æ¡†
                    joinModal.style.display = 'block';
                    modalInput.focus();
                }
            };
            
            // ç»§ç»­æŒ‘æˆ˜
            window.continueChallenge = function(challengeId) {
                // åˆ·æ–°å½“å‰é¡µé¢
                location.reload();
            };
            
            // æ·»åŠ ä¹¦ç±
            window.addBook = function(challengeId) {
                const input = document.getElementById(`bookInput-${challengeId}`);
                const bookName = input.value.trim();
                
                if (!bookName) {
                    alert('è¯·è¾“å…¥ä¹¦åï¼');
                    return;
                }
                
                // æ‰¾åˆ°å¯¹åº”çš„ç”¨æˆ·æŒ‘æˆ˜
                const challenge = userChallenges.find(ch => ch.id === challengeId);
                if (challenge) {
                    // æ£€æŸ¥æ˜¯å¦å·²è¾¾åˆ°æœ€å¤§ä¹¦ç±æ•°é‡
                    if (challenge.books.length >= challenge.bookCount) {
                        alert(`è¯¥æŒ‘æˆ˜æœ€å¤šåªèƒ½æ·»åŠ  ${challenge.bookCount} æœ¬ä¹¦ï¼`);
                        return;
                    }
                    
                    // æ£€æŸ¥ä¹¦ç±æ˜¯å¦å·²å­˜åœ¨
                    if (challenge.books.some(book => book.name === bookName)) {
                        alert('è¯¥ä¹¦å·²ç»æ·»åŠ è¿‡äº†ï¼');
                        return;
                    }
                    
                    // æ·»åŠ æ–°ä¹¦ç±
                    const newBook = {
                        id: Date.now(),
                        name: bookName,
                        completed: false
                    };
                    
                    challenge.books.push(newBook);
                    
                    // ä¿å­˜åˆ°localStorage
                    localStorage.setItem('userChallenges', JSON.stringify(userChallenges));
                    
                    // æ¸…ç©ºè¾“å…¥æ¡†
                    input.value = '';
                    
                    // é‡æ–°æ¸²æŸ“æŒ‘æˆ˜åˆ—è¡¨
                    renderChallenges(presetChallenges, userChallenges, document.querySelector('.filter-tab.active').dataset.filter);
                }
            };
            
            // åˆ‡æ¢ä¹¦ç±å®ŒæˆçŠ¶æ€
            window.toggleBookCompleted = function(challengeId, bookId) {
                // æ‰¾åˆ°å¯¹åº”çš„ç”¨æˆ·æŒ‘æˆ˜å’Œä¹¦ç±
                const challenge = userChallenges.find(ch => ch.id === challengeId);
                if (challenge) {
                    const book = challenge.books.find(b => b.id === bookId);
                    if (book) {
                        // åˆ‡æ¢å®ŒæˆçŠ¶æ€
                        book.completed = !book.completed;
                        
                        // æ›´æ–°æŒ‘æˆ˜çŠ¶æ€
                        const completedBooks = challenge.books.filter(b => b.completed).length;
                        if (completedBooks === challenge.bookCount) {
                            challenge.status = 'completed';
                        } else {
                            challenge.status = 'active';
                        }
                        
                        // ä¿å­˜åˆ°localStorage
                        localStorage.setItem('userChallenges', JSON.stringify(userChallenges));
                        
                        // é‡æ–°æ¸²æŸ“æŒ‘æˆ˜åˆ—è¡¨
                        renderChallenges(presetChallenges, userChallenges, document.querySelector('.filter-tab.active').dataset.filter);
                    }
                }
            };
            
            // æ·»åŠ ç­›é€‰æ ‡ç­¾äº‹ä»¶ç›‘å¬
            const filterTabs = document.querySelectorAll('.filter-tab');
            filterTabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    // ç§»é™¤æ‰€æœ‰æ´»è·ƒçŠ¶æ€
                    filterTabs.forEach(t => {
                        t.style.background = 'rgba(244, 228, 188, 0.9)';
                        t.style.border = '2px solid #8b4513';
                    });
                    // æ·»åŠ å½“å‰æ ‡ç­¾æ´»è·ƒçŠ¶æ€
                    this.style.background = 'linear-gradient(135deg, #d4a76a 0%, #8b4513 100%)';
                    this.style.border = '2px solid #8b4513';
                    
                    // é‡æ–°æ¸²æŸ“è¿‡æ»¤åçš„æŒ‘æˆ˜åˆ—è¡¨
                    renderChallenges(presetChallenges, userChallenges, this.dataset.filter);
                });
            });
        });
        
        // æ›´æ–°æŒ‘æˆ˜çŠ¶æ€ï¼ˆæ£€æŸ¥æ˜¯å¦è¶…æ—¶ï¼‰
        function updateChallengeStatuses(userChallenges) {
            const now = new Date();
            let statusChanged = false;
            
            userChallenges.forEach(challenge => {
                // åªæœ‰activeçŠ¶æ€çš„æŒ‘æˆ˜éœ€è¦æ£€æŸ¥
                if (challenge.status === 'active') {
                    const deadline = new Date(challenge.deadline);
                    if (now > deadline) {
                        // æŒ‘æˆ˜è¶…æ—¶ï¼Œæ ‡è®°ä¸ºå¤±è´¥
                        challenge.status = 'failed';
                        statusChanged = true;
                    }
                }
            });
            
            if (statusChanged) {
                localStorage.setItem('userChallenges', JSON.stringify(userChallenges));
            }
        }
        
        // æ¸²æŸ“æŒ‘æˆ˜åˆ—è¡¨
        function renderChallenges(presetChallenges, userChallenges, filter = 'all') {
            const challengeGrid = document.getElementById('challengeGrid');
            
            // è®¡ç®—å¯å‚åŠ çš„æŒ‘æˆ˜ï¼šæ‰€æœ‰ç³»ç»Ÿæ¨èæŒ‘æˆ˜ï¼ˆæ”¯æŒé‡å¤å‚åŠ ï¼‰
            const availableChallenges = presetChallenges;
            
            // è®¡ç®—å„çŠ¶æ€æŒ‘æˆ˜
            const now = new Date();
            const activeChallenges = userChallenges.filter(ch => {
                const deadline = new Date(ch.deadline);
                return ch.status === 'active' && now <= deadline;
            });
            
            const completedChallenges = userChallenges.filter(ch => {
                return ch.status === 'completed' || ch.status === 'failed';
            });
            
            // åˆå¹¶æ‰€æœ‰æŒ‘æˆ˜
            let allChallenges = [...availableChallenges, ...activeChallenges, ...completedChallenges];
            
            // æ ¹æ®ç­›é€‰æ¡ä»¶è¿‡æ»¤
            let filteredChallenges = allChallenges;
            if (filter === 'in-progress') {
                filteredChallenges = activeChallenges;
            } else if (filter === 'completed') {
                filteredChallenges = completedChallenges;
            } else if (filter === 'available') {
                filteredChallenges = availableChallenges;
            }
            
            // æ¸²æŸ“æŒ‘æˆ˜å¡ç‰‡
            challengeGrid.innerHTML = filteredChallenges.map(challenge => {
                // è®¡ç®—å·²å®Œæˆä¹¦ç±æ•°é‡
                const completedBooks = challenge.books ? challenge.books.filter(book => book.completed).length : 0;
                
                // ç”Ÿæˆä¹¦ç±åˆ—è¡¨HTML
                const booksHTML = challenge.books ? challenge.books.map(book => `
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.8rem; padding: 0.8rem; background: rgba(244, 228, 188, 0.7); border-radius: 6px; border: 1px solid #d4a76a;">
                        <span ${book.completed ? 'style="text-decoration: line-through; color: #8b4513;"' : ''}>${book.name}</span>
                        <input type="checkbox" ${book.completed ? 'checked' : ''} onchange="toggleBookCompleted(${challenge.id}, ${book.id})" style="width: 18px; height: 18px; accent-color: #d4a76a;">
                    </div>
                `).join('') : '';
                
                // ç”Ÿæˆæ·»åŠ ä¹¦ç±åŒºåŸŸHTML
                const addBookHTML = challenge.status === 'active' && (!challenge.books || challenge.books.length < challenge.bookCount) ? `
                    <div style="display: flex; gap: 0.8rem; margin-bottom: 1rem;">
                        <input type="text" id="bookInput-${challenge.id}" placeholder="è¾“å…¥ä¹¦å" style="flex: 1; padding: 0.8rem; background: rgba(255, 255, 255, 0.9); border: 2px solid #8b4513; border-radius: 8px; font-family: 'Georgia', serif; color: #3a2f1e;">
                        <button onclick="addBook(${challenge.id})" style="padding: 0.8rem 1.5rem; background: linear-gradient(135deg, #d4a76a 0%, #8b4513 100%); color: #3a2f1e; border: 2px solid #8b4513; border-radius: 8px; cursor: pointer; font-weight: bold; transition: all 0.3s ease; font-family: 'Georgia', serif;">æ·»åŠ ä¹¦ç±</button>
                    </div>
                ` : '';
                
                // ç”Ÿæˆè¿›åº¦æ¡HTML
                const progressHTML = challenge.status === 'active' ? `
                    <div style="margin: 1rem 0;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                            <span>å·²å®Œæˆ ${completedBooks}/${challenge.bookCount}</span>
                            <span>${Math.round((completedBooks / challenge.bookCount) * 100)}%</span>
                        </div>
                        <div style="width: 100%; height: 12px; background: rgba(244, 228, 188, 0.7); border-radius: 6px; overflow: hidden; border: 1px solid #d4a76a;">
                            <div style="width: ${(completedBooks / challenge.bookCount) * 100}%; height: 100%; background: linear-gradient(90deg, #d4a76a 0%, #8b4513 100%); transition: width 0.3s ease;"></div>
                        </div>
                    </div>
                ` : '';
                
                // ç”ŸæˆæŒ‘æˆ˜æ ‡é¢˜ï¼ˆå«è‡ªå®šä¹‰å€¼ï¼‰
                let challengeTitle = challenge.title;
                if (challenge.customValue) {
                    challengeTitle += ` Â· ${challenge.customValue}`;
                }
                
                // ç”ŸæˆçŠ¶æ€æ ‡ç­¾
                let statusTag = '';
                let achievementHTML = '';
                let cardStyle = '';
                let buttonHTML = '';
                
                if (challenge.status === 'available') {
                    buttonHTML = `<button onclick="joinChallenge(${challenge.id})" style="padding: 0.8rem 1.5rem; background: linear-gradient(135deg, #d4a76a 0%, #8b4513 100%); color: #3a2f1e; border: 2px solid #8b4513; border-radius: 8px; cursor: pointer; font-weight: bold; transition: all 0.3s ease; font-family: 'Georgia', serif;">å‚åŠ æŒ‘æˆ˜</button>`;
                } else if (challenge.status === 'active') {
                    statusTag = `<div style="position: absolute; top: 10px; right: 10px; background: linear-gradient(135deg, #d4a76a 0%, #8b4513 100%); color: #3a2f1e; padding: 0.3rem 0.8rem; border-radius: 20px; font-size: 0.8rem; font-weight: bold; border: 1px solid #8b4513;">è¿›è¡Œä¸­</div>`;
                    buttonHTML = `<button onclick="continueChallenge(${challenge.id})" style="padding: 0.8rem 1.5rem; background: linear-gradient(135deg, #d4a76a 0%, #8b4513 100%); color: #3a2f1e; border: 2px solid #8b4513; border-radius: 8px; cursor: pointer; font-weight: bold; transition: all 0.3s ease; font-family: 'Georgia', serif;">ç»§ç»­æŒ‘æˆ˜</button>`;
                } else if (challenge.status === 'completed') {
                    statusTag = `<div style="position: absolute; top: 10px; right: 10px; background: linear-gradient(135deg, #8b4513 0%, #d4a76a 100%); color: #3a2f1e; padding: 0.3rem 0.8rem; border-radius: 20px; font-size: 0.8rem; font-weight: bold; border: 1px solid #8b4513;">å·²å®Œæˆ</div>`;
                    achievementHTML = `
                        <div style="background: rgba(212, 167, 106, 0.2); padding: 1rem; border-radius: 8px; margin: 1rem 0; text-align: center;">
                            <div style="font-size: 2rem; margin-bottom: 0.5rem;">ğŸ‰</div>
                            <div style="font-weight: bold; margin-bottom: 0.5rem;">æ­å–œï¼Œå·²å®ŒæˆæŒ‘æˆ˜ï¼</div>
                            <div style="background: linear-gradient(135deg, #d4a76a 0%, #8b4513 100%); color: #3a2f1e; padding: 0.5rem 1rem; border-radius: 20px; display: inline-block; font-size: 0.9rem;">
                                ${challenge.type === 'author' ? 'ä½œè€…ç ”ç©¶è€…' : challenge.type === 'theme' ? 'ä¸»é¢˜æ¢ç´¢è€…' : 'é˜…è¯»å¿«æ‰‹'}
                            </div>
                        </div>
                    `;
                    buttonHTML = `<button disabled style="padding: 0.8rem 1.5rem; background: rgba(200, 200, 200, 0.7); color: #888; border: 2px solid #ccc; border-radius: 8px; cursor: not-allowed; font-weight: bold; font-family: 'Georgia', serif;">å·²å®Œæˆ</button>`;
                } else if (challenge.status === 'failed') {
                    statusTag = `<div style="position: absolute; top: 10px; right: 10px; background: linear-gradient(135deg, #772e25 0%, #c1121f 100%); color: white; padding: 0.3rem 0.8rem; border-radius: 20px; font-size: 0.8rem; font-weight: bold; border: 1px solid #772e25;">æœªå®Œæˆ</div>`;
                    achievementHTML = `
                        <div style="background: rgba(193, 18, 31, 0.1); padding: 1rem; border-radius: 8px; margin: 1rem 0; text-align: center;">
                            <div style="font-size: 2rem; margin-bottom: 0.5rem;">ğŸ˜</div>
                            <div style="color: #c1121f; margin-bottom: 0.5rem;">æœªå®ŒæˆæŒ‘æˆ˜</div>
                        </div>
                    `;
                    cardStyle = 'opacity: 0.7;';
                    buttonHTML = `<button disabled style="padding: 0.8rem 1.5rem; background: rgba(200, 200, 200, 0.7); color: #888; border: 2px solid #ccc; border-radius: 8px; cursor: not-allowed; font-weight: bold; font-family: 'Georgia', serif;">å·²ç»“æŸ</button>`;
                }
                
                // ç”ŸæˆæŒ‘æˆ˜å¡ç‰‡
                return `
                    <div class="card" style="position: relative; ${cardStyle}">
                        ${statusTag}
                        <h3>${challengeTitle}</h3>
                        <p style="color: #8b4513; margin-bottom: 1rem;">${challenge.description}</p>
                        <div style="margin-bottom: 1rem; color: #8b4513; font-size: 0.9rem;">
                            ${challenge.difficulty === 'ç®€å•' ? 'â­ï¸ ç®€å•' : challenge.difficulty === 'ä¸­ç­‰' ? 'â­ï¸â­ï¸ ä¸­ç­‰éš¾åº¦' : 'â­ï¸â­ï¸â­ï¸ å›°éš¾'} Â· ğŸ“… ${challenge.duration} Â· ğŸ“š ${challenge.bookCount}æœ¬ä¹¦
                        </div>
                        
                        ${progressHTML}
                        
                        ${addBookHTML}
                        
                        ${booksHTML}
                        
                        ${achievementHTML}
                        
                        <div style="display: flex; justify-content: center; margin-top: 1.5rem;">
                            ${buttonHTML}
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        // ç§»åŠ¨ç«¯èœå•åˆ‡æ¢
        function toggleMenu() {
            const navLinks = document.querySelector('.nav-links');
            navLinks.classList.toggle('active');
        }
    </script>
</body>
</html>